<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 5.4.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>james分布式版本部署二 - 苏三博客</title>

  
    <meta name="description" content="james分布式版本部署">
<meta property="og:type" content="article">
<meta property="og:title" content="james分布式版本部署二">
<meta property="og:url" content="https://su3.cn/2025/02/10/2025james02/index.html">
<meta property="og:site_name" content="苏三博客">
<meta property="og:description" content="james分布式版本部署">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-02-10T10:00:00.000Z">
<meta property="article:modified_time" content="2025-02-13T15:00:00.000Z">
<meta property="article:author" content="SuSan">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="笔记">

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  

  

  


  
    
      <link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/lxgwwenkaiscreen.css" rel="stylesheet">
    
  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar"  style="width:52px;height:52px;" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/pic.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title" style="font-size: 1.12rem;">苏三博客</div><div class="sub cap" style="margin-top:3px;font-size:10px;color:#CD853F;">- Su3.cn 无限制,有些线路较慢</div><div class="sub cap" style="margin-top:3px;font-size:10px;color:green;">- Xen.cc 静态资源托管加速,限流</div></a></div>

<nav class="menu dis-select"><a class="nav-item active" href="/">博客</a><a class="nav-item" href="/utils/">工具</a><a class="nav-item" href="/music/">歌单</a><a class="nav-item" href="/about/">更多</a></nav>
</header>


<div class="widgets">

<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">james分布式版本部署二</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE"><span class="toc-text">一些配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenSearch"><span class="toc-text">OpenSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker"><span class="toc-text">docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8"><span class="toc-text">手动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS-%E9%85%8D%E7%BD%AE"><span class="toc-text">DNS 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-DMARC"><span class="toc-text">配置 DMARC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="toc-text">nginx配置文件参考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-James"><span class="toc-text">安装 James</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-james"><span class="toc-text">配置 james</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl%E8%AF%81%E4%B9%A6%E6%96%B9%E5%BC%8F%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-text">ssl证书方式（推荐）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85"><span class="toc-text">证书安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-James-%E9%85%8D%E7%BD%AE"><span class="toc-text">修改 James 配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#blob-properties"><span class="toc-text">blob.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cassandra-properties"><span class="toc-text">cassandra.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#imapserver-xml"><span class="toc-text">imapserver.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#opensearch-properties"><span class="toc-text">opensearch.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pop3server-xml"><span class="toc-text">pop3server.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rabbitmq-properties"><span class="toc-text">rabbitmq.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#smtpserver-xml"><span class="toc-text">smtpserver.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tika-properties"><span class="toc-text">tika.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webadmin-properties"><span class="toc-text">webadmin.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jmap-properties"><span class="toc-text">jmap.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-text">启动脚本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E8%84%9A%E6%9C%AC%E6%B7%BB%E5%8A%A0%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90"><span class="toc-text">为脚本添加执行权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8James-%E6%9C%8D%E5%8A%A1"><span class="toc-text">启动James 服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%96%E8%80%85%E9%87%8D%E5%90%AFJames-%E6%9C%8D%E5%8A%A1"><span class="toc-text">或者重启James 服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99%EF%BC%8C%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%8B%E8%AF%81%E4%B9%A6"><span class="toc-text">如果启动报错，查看一下证书</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8"><span class="toc-text">手动启动</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="toc-text">开机启动</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F"><span class="toc-text">配置自动续期</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B"><span class="toc-text">自动续期状态检测</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E7%BB%AD%E6%9C%9F"><span class="toc-text">强制续期</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%AD%E6%9C%9F%E9%92%A9%E5%AD%90%E9%87%8D%E5%90%AFjames"><span class="toc-text">续期钩子重启james</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E8%84%9A%E6%9C%AC%E6%B7%BB%E5%8A%A0%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90-1"><span class="toc-text">为脚本添加执行权限</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E5%BA%93%E6%96%B9%E5%BC%8F%EF%BC%88%E5%BC%83%E7%94%A8%EF%BC%89"><span class="toc-text">密钥库方式（弃用）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%BA%93"><span class="toc-text">生成密钥库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#blob-properties-1"><span class="toc-text">blob.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cassandra-properties-1"><span class="toc-text">cassandra.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#imapserver-xml-1"><span class="toc-text">imapserver.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#opensearch-properties-1"><span class="toc-text">opensearch.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pop3server-xml-1"><span class="toc-text">pop3server.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rabbitmq-properties-1"><span class="toc-text">rabbitmq.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#smtpserver-xml-1"><span class="toc-text">smtpserver.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tika-properties-1"><span class="toc-text">tika.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webadmin-properties-1"><span class="toc-text">webadmin.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jmap-properties-1"><span class="toc-text">jmap.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-James"><span class="toc-text">启动 James</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-DKIM"><span class="toc-text">配置 DKIM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-James-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">安装 James 客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8B%E5%B9%B6%E8%BF%9B%E5%85%A5%E7%9B%AE%E5%BD%95"><span class="toc-text">解压并进入目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E7%BC%96%E8%AF%91"><span class="toc-text">打包编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9B%AE%E5%BD%95"><span class="toc-text">进入客户端目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%9F%9F"><span class="toc-text">添加域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%88%97%E8%A1%A8"><span class="toc-text">查看域列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-text">添加用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-text">查看用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E6%8C%87%E4%BB%A4"><span class="toc-text">更多指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95James"><span class="toc-text">测试James</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opensearch%E6%9F%A5%E7%9C%8B%E9%82%AE%E4%BB%B6"><span class="toc-text">opensearch查看邮件</span></a></li></ol></div></div></widget>




</div>


    </aside>
    <div class='l_main'>
      

      



<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/James/">James</a></div><div id="post-meta">发布于&nbsp;<time datetime="2025-02-10T10:00:00.000Z">2025-02-10</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>james分布式版本部署二</span></h1>
<h2 id="一些配置"><a href="#一些配置" class="headerlink" title="一些配置"></a>一些配置</h2><h3 id="OpenSearch"><a href="#OpenSearch" class="headerlink" title="OpenSearch"></a>OpenSearch</h3><p>OpenSearch 要确保把SSL访问关闭，且安全认证取消，不然James是无法访问的。</p>
<h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><p>如果通过命令 docker exec -it opensearch bash 进入到 OpenSearch 客户端，运行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#进入到 OpenSearch 客户端</span><br><span class="line">docker exec -it opensearch bash</span><br><span class="line">vi /config/opensearch.yml</span><br><span class="line">#修改配置信息如下：</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">#放开，去掉注释，注意格式，空格</span><br><span class="line">discovery.type: single-node</span><br><span class="line">#新增</span><br><span class="line">plugins.security.disabled: true</span><br><span class="line">plugins.security.ssl.http.enabled: false</span><br></pre></td></tr></table></figure>

<p>退出容器</p>
<p>使用 exit 或 Ctrl + D 退出并停止容器。<br>使用 Ctrl + P + Q 退出但不停止容器。<br>使用 docker ps 检查容器状态</p>
<p>重启容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart opensearch</span><br></pre></td></tr></table></figure>

<h4 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h4><p>手动安装的OpenSearch无需配置，在前面安装的时候已经配置好了</p>
<h3 id="DNS-配置"><a href="#DNS-配置" class="headerlink" title="DNS 配置"></a>DNS 配置</h3><p>添加以下配置可以成功发送Gmail邮箱，否则会被Gmail退信</p>
<p>添加或更新 SPF 记录： 在你的域的 DNS 管理界面中，添加或更新 SPF 记录（即添加TXT解析）<br>以包含发件 IP 地址 x.x.x.x。以下是一个示例 SPF 记录：<br>添加TXT解析，名称为@ 值为：v=spf1 a mx ip4:x.x.x.x -all<br>添加TXT解析，名称为mail 值为：v=spf1 a mx ip4:x.x.x.x -all<br>添加A解析，名称为mail 值为：服务器ip<br>v=spf1 表示这是一个 SPF 记录。<br>ip4:x.x.x.x 允许 x.x.x.x 代表 域名.后缀 发送邮件。<br>-all 表示仅允许明确列出的 IP 地址发送邮件，其他 IP 地址将被拒绝。</p>
<p>验证 SPF 记录是否生效： 等待 DNS 记录生效（通常几分钟到 48 小时），在服务器中输入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dig +short TXT 域名.后缀</span><br><span class="line">#示例</span><br><span class="line">root@mail-test:/data/james/james382/conf# dig +short TXT 域名.后缀</span><br><span class="line">&quot;pf1 a mx ip4:x.x.x.x  -all&quot;</span><br><span class="line">root@mail-test:/data/james/james382/conf#</span><br></pre></td></tr></table></figure>


<h3 id="配置-DMARC"><a href="#配置-DMARC" class="headerlink" title="配置 DMARC"></a>配置 DMARC</h3><p>添加 DMARC 记录到 DNS： 在你的 DNS 中添加 DMARC TXT 记录<br>名称：_dmarc<br>值例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v=DMARC1; p=quarantine; rua=mailto:postmaster@域名.后缀; pct=100; adkim=s; aspf=s</span><br></pre></td></tr></table></figure>
<p>p=reject 表示未通过 SPF/DKIM 的邮件将被拒收。<br>rua=mailto:dmarc-reports@域名.后缀 表示将 DMARC 报告发送到指定邮箱</p>
<p>验证 DMARC 是否生效</p>
<p><a target="_blank" rel="noopener" href="https://mxtoolbox.com/">mxtoolbox</a></p>
<p>输入域名（域名.后缀），点击MX Lookup验证</p>
<h3 id="nginx配置文件参考"><a href="#nginx配置文件参考" class="headerlink" title="nginx配置文件参考"></a>nginx配置文件参考</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@mail:/# nginx -v</span><br><span class="line">nginx version: nginx/1.18.0 (Ubuntu)</span><br><span class="line">root@mail:/# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">root@mail:/#</span><br></pre></td></tr></table></figure>
<p>这个是配置文件路径： /etc/nginx/nginx.conf 下面是配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">        worker_connections 768;</span><br><span class="line">        # multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Basic Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        sendfile on;</span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        tcp_nodelay on;</span><br><span class="line">        keepalive_timeout 65;</span><br><span class="line">        types_hash_max_size 2048;</span><br><span class="line">        # server_tokens off;</span><br><span class="line"></span><br><span class="line">        # server_names_hash_bucket_size 64;</span><br><span class="line">        # server_name_in_redirect off;</span><br><span class="line"></span><br><span class="line">        include /etc/nginx/mime.types;</span><br><span class="line">        default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # SSL Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        access_log /var/log/nginx/access.log;</span><br><span class="line">        error_log /var/log/nginx/error.log;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        # gzip_vary on;</span><br><span class="line">        # gzip_proxied any;</span><br><span class="line">        # gzip_comp_level 6;</span><br><span class="line">        # gzip_buffers 16 8k;</span><br><span class="line">        # gzip_http_version 1.1;</span><br><span class="line">        # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Virtual Host Configs</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        include /etc/nginx/conf.d/*.conf;</span><br><span class="line">        include /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#mail &#123;</span><br><span class="line">#       # See sample authentication script at:</span><br><span class="line">#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span><br><span class="line"># </span><br><span class="line">#       # auth_http localhost/auth.php;</span><br><span class="line">#       # pop3_capabilities &quot;TOP&quot; &quot;USER&quot;;</span><br><span class="line">#       # imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;;</span><br><span class="line"># </span><br><span class="line">#       server &#123;</span><br><span class="line">#               listen     localhost:110;</span><br><span class="line">#               protocol   pop3;</span><br><span class="line">#               proxy      on;</span><br><span class="line">#       &#125;</span><br><span class="line"># </span><br><span class="line">#       server &#123;</span><br><span class="line">#               listen     localhost:143;</span><br><span class="line">#               protocol   imap;</span><br><span class="line">#               proxy      on;</span><br><span class="line">#       &#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure>

<p>查看后发现不对，切换路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/sites-available</span><br><span class="line">root@mail:/etc/nginx/sites-available# ls</span><br><span class="line">default</span><br><span class="line">root@mail:/etc/nginx/sites-available# cat default </span><br></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># 全局 HTTPS 重定向配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name 域名.ai www.域名.ai www.域名.com backend.域名.com 域名.com 域名.ai www.域名.ai teman.域名.ai;</span><br><span class="line">    location /.well-known/acme-challenge/ &#123;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置官网静态文件服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name temail.ai www.域名.ai;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/temail.ai/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/temail.ai/privkey.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">    root /data/apps/website;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱客户端前端服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.域名.com 域名.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/mail.域名.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.域名.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    root /data/apps/webmail/dist;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    # 自定义错误页面配置</span><br><span class="line">    error_page 404 /index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">    # 处理自定义 404 页面</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">        root /data/apps/webmail;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱后台服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name teman.域名.ai;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/teman.域名.ai/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/teman.域名.ai/privkey.pem;</span><br><span class="line"></span><br><span class="line">    root /data/apps/webadmin/dist;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    # 自定义错误页面配置</span><br><span class="line">    error_page 404 /index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">    # 处理自定义 404 页面</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">        root /data/apps/webadmin;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱客户端后端服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name backend.域名.com;</span><br><span class="line">    client_max_body_size 30M;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/mail.域名.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.域名.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:6001;  # 转发到本地监听的服务</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试服配置示例，共启用了<br>home.kretest.com<br><a target="_blank" rel="noopener" href="http://www.kretest.com/">www.kretest.com</a><br>backend.kretest.com<br>kretest.com<br>teman.kretest.com<br>mail.kretest.com<br>这些域名，可以先提前解析好，后面生成证书的时候需要用到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># 全局 HTTPS 重定向配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name home.kretest.com www.kretest.com  backend.kretest.com kretest.com   teman.kretest.com;</span><br><span class="line">    location /.well-known/acme-challenge/ &#123;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置官网静态文件服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name home.kretest.com;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/mail.kretest.com/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.kretest.com/privkey.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">    root /data/apps/website;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱客户端前端服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.kretest.com kretest.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/mail.kretest.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.kretest.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    root /data/apps/webmail/dist;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    # 自定义错误页面配置</span><br><span class="line">    error_page 404 /index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">    # 处理自定义 404 页面</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">        root /data/apps/webmail;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱后台服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name teman.kretest.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/mail.kretest.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.kretest.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    root /data/apps/webadmin/dist;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    # 自定义错误页面配置</span><br><span class="line">    error_page 404 /index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">    # 处理自定义 404 页面</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">        root /data/apps/webadmin;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置邮箱客户端后端服务</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name backend.kretest.com;</span><br><span class="line">    client_max_body_size 30M;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /etc/letsencrypt/live/mail.kretest.com/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/mail.kretest.com/privkey.pem;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:6001;  # 转发到本地监听的服务</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后重启nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="安装-James"><a href="#安装-James" class="headerlink" title="安装 James"></a>安装 James</h2><p>James 下载地址：<a target="_blank" rel="noopener" href="https://dlcdn.apache.org/james/server/3.8.2/james-server-distributed-guice.zip">https://dlcdn.apache.org/james/server/3.8.2/james-server-distributed-guice.zip</a></p>
<p>如果链接无法访问，可能是官方更新了版本，浏览器访问 <a target="_blank" rel="noopener" href="https://dlcdn.apache.org/james/server/">https://dlcdn.apache.org/james/server/</a> 查看版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dlcdn.apache.org/james/server/3.8.2/james-server-distributed-guice.zip</span><br></pre></td></tr></table></figure>
<p>我之前下载james的安装包丢在home/james下面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mv james-server-distributed-guice.zip /data/james/</span><br><span class="line">unzip james-server-distributed-guice.zip</span><br><span class="line">root@mail-test:/data/james# ls</span><br><span class="line">james-server-distributed-app  james-server-distributed-guice.zip</span><br><span class="line">root@mail-test:/data/james# rm -rf james-server-distributed-guice.zip </span><br><span class="line">root@mail-test:/data/james# ls</span><br><span class="line">james-server-distributed-app</span><br><span class="line">root@mail-test:/data/james# mv james-server-distributed-app james382</span><br><span class="line">root@mail-test:/data/james# ls</span><br><span class="line">james382</span><br><span class="line">root@mail-test:/data/james# </span><br></pre></td></tr></table></figure>

<h3 id="配置-james"><a href="#配置-james" class="headerlink" title="配置 james"></a>配置 james</h3><h4 id="ssl证书方式（推荐）"><a href="#ssl证书方式（推荐）" class="headerlink" title="ssl证书方式（推荐）"></a>ssl证书方式（推荐）</h4><h5 id="证书安装"><a href="#证书安装" class="headerlink" title="证书安装"></a>证书安装</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx</span><br></pre></td></tr></table></figure>
<p>在申请证书前，请确保要申请的域名（例如 example.com 或 <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> ）已经解析到服务器的 IP 地址，否则验证会失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d xx.com -d mail.xx.com -d www.xx.com</span><br></pre></td></tr></table></figure>
<p>有几个域名就-d几次,根据上面nginx配置的域名示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d home.kretest.com -d www.kretest.com -d backend.kretest.com -d kretest.com -d mail.xx.com -d teman.kretest.com</span><br></pre></td></tr></table></figure>

<p>可能报错一：</p>
<p>这里执行报nginx相关的错误，启动nginx报错，80端口被占用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/etc/letsencrypt# sudo lsof -i :80</span><br><span class="line">COMMAND      PID     USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">google_gu 548101     root    3u  IPv4 2625353      0t0  TCP mail-test.us-west1-b.c.atouch-live-20240921.internal:54170-&gt;metadata.google.internal:http (ESTABLISHED)</span><br><span class="line">google_os 553385     root    3u  IPv4 2630491      0t0  TCP mail-test.us-west1-b.c.atouch-live-20240921.internal:48900-&gt;metadata.google.internal:http (ESTABLISHED)</span><br><span class="line">apache2   597884     root    4u  IPv6 2813783      0t0  TCP *:http (LISTEN)</span><br><span class="line">apache2   597886 www-data    4u  IPv6 2813783      0t0  TCP *:http (LISTEN)</span><br><span class="line">apache2   597887 www-data    4u  IPv6 2813783      0t0  TCP *:http (LISTEN)</span><br></pre></td></tr></table></figure>
<p>google_gu 和 google_os：<br>这些进程是 Google Cloud 的元数据服务客户端，用于与 Google Cloud 的元数据服务器 (metadata.google.internal) 通信。<br>它们使用的是 出站连接（从你的服务器到 Google 的元数据服务器），而不是监听 80 端口。因此，它们不会影响 Nginx 启动。<br>可以忽略这些进程。<br>apache2：<br>apache2 是 Apache HTTP 服务器，它正在监听 80 端口（TCP *:http 表示监听所有 IPv4 和 IPv6 地址的 80 端口）。<br>这是导致 Nginx 无法启动的原因，因为 Apache 已经占用了 80 端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop apache2          # 停止 Apache</span><br><span class="line">sudo systemctl disable apache2       # 禁用 Apache，防止它开机自启</span><br><span class="line">sudo systemctl start nginx</span><br><span class="line">systemctl status nginx                 # 查看nginx启动状态</span><br></pre></td></tr></table></figure>

<p>如果nginx已经启动成功，但是生成证书操作还报红色错误说nginx配置不对，则打开nginx配置文件，把所有关于ssl和443的配置注释掉再来执行生成证书操作。</p>
<p>可能报错二：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/runTime/james/james382# sudo certbot --nginx -d home.kretest.com -d www.kretest.com -d backend.kretest.com -d kretest.com -d mail.kretest.com -d teman.kretest.com</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Error while running nginx -c /etc/nginx/nginx.conf -t.</span><br><span class="line"></span><br><span class="line">nginx: [emerg] cannot load certificate &quot;/etc/letsencrypt/live/home.kretest.com/fullchain.pem&quot;: BIO_new_file() failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen(&#x27;/etc/letsencrypt/live/home.kretest.com/fullchain.pem&#x27;,&#x27;r&#x27;) error:2006D080:BIO routines:BIO_new_file:no such file)</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test failed</span><br><span class="line"></span><br><span class="line">The nginx plugin is not working; there may be problems with your existing configuration.</span><br><span class="line">The error was: MisconfigurationError(&#x27;Error while running nginx -c /etc/nginx/nginx.conf -t.\n\nnginx: [emerg] cannot load certificate &quot;/etc/letsencrypt/live/home.kretest.com/fullchain.pem&quot;: BIO_new_file() failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen(\&#x27;/etc/letsencrypt/live/home.kretest.com/fullchain.pem\&#x27;,\&#x27;r\&#x27;) error:2006D080:BIO routines:BIO_new_file:no such file)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n&#x27;)</span><br></pre></td></tr></table></figure>

<p>这是因为之前nginx中配置了证书，但是现在找不到证书,这里先一撸到底，全删掉，等下又设置回来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 全局 HTTPS 重定向配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name home.kretest.com www.kretest.com  backend.kretest.com kretest.com   teman.kretest.com;</span><br><span class="line">    location /.well-known/acme-challenge/ &#123;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/etc/nginx/sites-available# sudo certbot --nginx -d home.kretest.com -d www.kretest.com -d backend.kretest.com -d kretest.com -d mail.kretest.com -d teman.kretest.com</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator nginx, Installer nginx</span><br><span class="line">Enter email address (used for urgent renewal and security notices) (Enter &#x27;c&#x27; to</span><br><span class="line">cancel): xxx@gmail.com</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Please read the Terms of Service at</span><br><span class="line">https://letsencrypt.org/documents/LE-SA-v1.4-April-3-2024.pdf. You must agree in</span><br><span class="line">order to register with the ACME server at</span><br><span class="line">https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(A)gree/(C)ancel: a</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Would you be willing to share your email address with the Electronic Frontier</span><br><span class="line">Foundation, a founding partner of the Let&#x27;s Encrypt project and the non-profit</span><br><span class="line">organization that develops Certbot? We&#x27;d like to send you email about our work</span><br><span class="line">encrypting the web, EFF news, campaigns, and ways to support digital freedom.</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(Y)es/(N)o: n</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br></pre></td></tr></table></figure>

<p>可能出现的问题，创建命令里面有多个域名，但是最终只生成出来了1个证书，这是因为申请的是一个多域名证书（SAN证书），即在一个证书中包含了多个域名的信息</p>
<p>Certbot 已生成 Let’s Encrypt 证书，路径如下：<br>•        公钥证书：/etc/letsencrypt/live/域名/fullchain.pem<br>•        私钥：/etc/letsencrypt/live/域名/privkey.pem</p>
<p>确保 James 用户对这些文件有读取权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/etc/nginx/sites-available# cd /etc/letsencrypt/live/mail.kretest.com</span><br><span class="line">root@mail-test:/etc/letsencrypt/live/mail.kretest.com# ls</span><br><span class="line">README  cert.pem  chain.pem  fullchain.pem  privkey.pem</span><br><span class="line">root@mail-test:/etc/letsencrypt/live/mail.kretest.com# ll</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 13 08:34 ./</span><br><span class="line">drwx------ 3 root root 4096 Feb 13 08:33 ../</span><br><span class="line">-rw-r--r-- 1 root root  692 Feb 13 08:33 README</span><br><span class="line">lrwxrwxrwx 1 root root   40 Feb 13 08:34 cert.pem -&gt; ../../archive/mail.kretest.com/cert2.pem</span><br><span class="line">lrwxrwxrwx 1 root root   41 Feb 13 08:34 chain.pem -&gt; ../../archive/mail.kretest.com/chain2.pem</span><br><span class="line">lrwxrwxrwx 1 root root   45 Feb 13 08:34 fullchain.pem -&gt; ../../archive/mail.kretest.com/fullchain2.pem</span><br><span class="line">lrwxrwxrwx 1 root root   43 Feb 13 08:34 privkey.pem -&gt; ../../archive/mail.kretest.com/privkey2.pem</span><br><span class="line">root@mail-test:/etc/letsencrypt/live/mail.kretest.com# cd ../../archive/mail.kretest.com/</span><br><span class="line">root@mail-test:/etc/letsencrypt/archive/mail.kretest.com# ls</span><br><span class="line">cert1.pem  cert2.pem  chain1.pem  chain2.pem  fullchain1.pem  fullchain2.pem  privkey1.pem  privkey2.pem</span><br><span class="line">root@mail-test:/etc/letsencrypt/archive/mail.kretest.com# ll</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 13 08:34 ./</span><br><span class="line">drwx------ 3 root root 4096 Feb 13 08:33 ../</span><br><span class="line">-rw-r--r-- 1 root root 1773 Feb 13 08:33 cert1.pem</span><br><span class="line">-rw-r--r-- 1 root root 1895 Feb 13 08:34 cert2.pem</span><br><span class="line">-rw-r--r-- 1 root root 1801 Feb 13 08:33 chain1.pem</span><br><span class="line">-rw-r--r-- 1 root root 1801 Feb 13 08:34 chain2.pem</span><br><span class="line">-rw-r--r-- 1 root root 3574 Feb 13 08:33 fullchain1.pem</span><br><span class="line">-rw-r----- 1 root root 3696 Feb 13 08:34 fullchain2.pem</span><br><span class="line">-rw------- 1 root root 1704 Feb 13 08:33 privkey1.pem</span><br><span class="line">-rw-r----- 1 root root 1704 Feb 13 08:34 privkey2.pem</span><br><span class="line">root@mail-test:/etc/letsencrypt/archive/mail.kretest.com# sudo chmod 640 privkey2.pem </span><br><span class="line">root@mail-test:/etc/letsencrypt/archive/mail.kretest.com# sudo chmod 640 fullchain2.pem </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 640 /etc/letsencrypt/live/域名/privkey.pem</span><br><span class="line">sudo chmod 640 /etc/letsencrypt/live/域名/fullchain.pem</span><br><span class="line"></span><br><span class="line">#检测组名是否存在</span><br><span class="line">getent group james</span><br><span class="line">#如果组名不存在则创建</span><br><span class="line">sudo groupadd james</span><br><span class="line"></span><br><span class="line">sudo chown root:james /etc/letsencrypt/live/域名/privkey.pem</span><br><span class="line">sudo chown root:james /etc/letsencrypt/live/域名/fullchain.pem</span><br></pre></td></tr></table></figure>

<p>在james项目的根目录新建文件夹encrypt，把生成的证书移动进来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir encrypt</span><br><span class="line">#mv /etc/letsencrypt/live/域名.com/privkey.pem /data/james/james382/encrypt/</span><br><span class="line">#mv /etc/letsencrypt/live/域名.com/fullchain.pem /data/james/james382/encrypt/</span><br><span class="line">chmod 777 encrypt</span><br><span class="line"></span><br><span class="line">#注意要看看，/etc/letsencrypt/live/域名.com/下的证书是不是真的文件，如是一个相对路径的软连接，删除或者复制都无效了。那么则需要进入真实路径去复制或者移动</span><br><span class="line"></span><br><span class="line">#cp -L /etc/letsencrypt/live/kretest.com/privkey.pem /data/james/james382/encrypt/</span><br><span class="line">#cp -L /etc/letsencrypt/live/kretest.com/fullchain.pem /data/james/james382/encrypt/</span><br><span class="line"></span><br><span class="line">cp 证书真实绝对路径  /data/james/james382/encrypt/</span><br><span class="line">chmod 777 privkey.pem</span><br><span class="line">chmod 777 fullchain.pem</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/runTime/james/james382# cp /etc/letsencrypt/archive/mail.kretest.com/privkey2.pem /data/runTime/james/james382/encrypt/privkey.pem</span><br><span class="line">root@mail-test:/data/runTime/james/james382# cp /etc/letsencrypt/archive/mail.kretest.com/fullchain2.pem /data/runTime/james/james382/encrypt/fullchain.pem</span><br><span class="line">root@mail-test:/data/runTime/james/james382# cd encrypt/</span><br><span class="line">root@mail-test:/data/runTime/james/james382/encrypt# ls</span><br><span class="line">fullchain.pem  privkey.pem</span><br><span class="line">root@mail-test:/data/runTime/james/james382/encrypt# chmod 777 privkey.pem</span><br><span class="line">root@mail-test:/data/runTime/james/james382/encrypt# chmod 777 fullchain.pem</span><br></pre></td></tr></table></figure>

<h5 id="修改-James-配置"><a href="#修改-James-配置" class="headerlink" title="修改 James 配置"></a>修改 James 配置</h5><p>James默认配置文件在系统文件位于 ./conf 文件夹下</p>
<h5 id="blob-properties"><a href="#blob-properties" class="headerlink" title="blob.properties"></a>blob.properties</h5><p>主要需要调整 ObjectStorage on S3 模块，将之前搭建好的 S3 服务器配置信息填上去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bjectstorage.s3.endPoint=https://xx-xx.s3.amazonaws.com/mail/ # S3 的读取器地址，换成自己的IP和端口</span><br><span class="line">objectstorage.s3.bucketName=xx-xx（这个可能需要新增）</span><br><span class="line">objectstorage.s3.region=us-east-1</span><br><span class="line">objectstorage.s3.accessKeyId=accessKey1 # S3 的accessKey（创建的时候有指定）</span><br><span class="line">objectstorage.s3.secretKey=secretKey1 # S3 的secretKey（创建的时候有指定）</span><br></pre></td></tr></table></figure>

<p>修改后的blob.properties文件参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># ============================================= BlobStore Implementation ==================================</span><br><span class="line"># Read https://james.apache.org/server/config-blobstore.html for further details</span><br><span class="line"></span><br><span class="line"># Choose your BlobStore implementation</span><br><span class="line"># Mandatory, allowed values are: cassandra, s3</span><br><span class="line"># *WARNING*: JAMES-3591 Cassandra is not made to store large binary content, its use will be suboptimal compared to</span><br><span class="line"># alternatives (namely S3 compatible BlobStores backed by for instance S3, MinIO or Ozone)</span><br><span class="line">implementation=s3</span><br><span class="line"></span><br><span class="line"># ========================================= Deduplication ========================================</span><br><span class="line"># If you choose to enable deduplication, the mails with the same content will be stored only once.</span><br><span class="line"># Warning: Once this feature is enabled, there is no turning back as turning it off will lead to the deletion of all</span><br><span class="line"># the mails sharing the same content once one is deleted.</span><br><span class="line"># Mandatory, Allowed values are: true, false</span><br><span class="line">deduplication.enable=false</span><br><span class="line"></span><br><span class="line"># deduplication.family needs to be incremented every time the deduplication.generation.duration is changed</span><br><span class="line"># Positive integer, defaults to 1</span><br><span class="line"># deduplication.gc.generation.family=1</span><br><span class="line"></span><br><span class="line"># Duration of generation.</span><br><span class="line"># Deduplication only takes place within a singe generation.</span><br><span class="line"># Only items two generation old can be garbage collected. (This prevent concurrent insertions issues and</span><br><span class="line"># accounts for a clock skew).</span><br><span class="line"># deduplication.family needs to be incremented everytime this parameter is changed.</span><br><span class="line"># Duration. Default unit: days. Defaults to 30 days.</span><br><span class="line"># deduplication.gc.generation.duration=30days</span><br><span class="line"></span><br><span class="line"># ========================================= Encryption ========================================</span><br><span class="line"># If you choose to enable encryption, the blob content will be encrypted before storing them in the BlobStore.</span><br><span class="line"># Warning: Once this feature is enabled, there is no turning back as turning it off will lead to all content being</span><br><span class="line"># encrypted. This comes at a performance impact but presents you from leaking data if, for instance the third party</span><br><span class="line"># offering you a S3 service is compromised.</span><br><span class="line"># Optional, Allowed values are: true, false, defaults to false</span><br><span class="line">encryption.aes.enable=false</span><br><span class="line"></span><br><span class="line"># Mandatory (if AES encryption is enabled) salt and password. Salt needs to be an hexadecimal encoded string</span><br><span class="line">#encryption.aes.password=xxx</span><br><span class="line">#encryption.aes.salt=73616c7479</span><br><span class="line"># Optional, defaults to PBKDF2WithHmacSHA512</span><br><span class="line">#encryption.aes.private.key.algorithm=PBKDF2WithHmacSHA512</span><br><span class="line"></span><br><span class="line"># ========================================= Cassandra BlobStore Cache ======================================</span><br><span class="line"># A cassandra cache can be enabled to reduce latency when reading small blobs frequently</span><br><span class="line"># A dedicated keyspace with a replication factor of one is then used</span><br><span class="line"># Cache eviction policy is TTL based</span><br><span class="line"># Only blobs below a given threshold will be stored.</span><br><span class="line"># To be noted that blobs are stored within a single Cassandra row, hence a low threshold should be used.</span><br><span class="line"></span><br><span class="line"># Enable the cache? Optional and default to false. Must be a boolean.</span><br><span class="line">cache.enable=false</span><br><span class="line"></span><br><span class="line"># Cache eviction policy is TTL based. Optional and defaults to 7 days. Must be a duration.</span><br><span class="line"># Valid units: ms, sec, min, hour, day, week, month, year</span><br><span class="line"># cache.cassandra.ttl=7days</span><br><span class="line"></span><br><span class="line"># Timeout after which this cache should be bypassed. Optional and defaults to 100ms. Can not exceed 1 hour.</span><br><span class="line"># Must be a duration Valid units: ms, sec, min, hour, day, week, month, year</span><br><span class="line"># cache.cassandra.timeout=100ms</span><br><span class="line"></span><br><span class="line"># Maximum size of stored objects expressed in bytes. Must be strictly positive. Defaults to 8192.</span><br><span class="line"># Units: bytes, Kib, MiB, GiB, TiB</span><br><span class="line"># cache.sizeThresholdInBytes=8 KiB</span><br><span class="line"></span><br><span class="line"># ============================================== ObjectStorage ============================================</span><br><span class="line"></span><br><span class="line"># ========================================= ObjectStorage Buckets ==========================================</span><br><span class="line"># bucket names prefix</span><br><span class="line"># Optional, default no prefix</span><br><span class="line"># objectstorage.bucketPrefix=prod-</span><br><span class="line"></span><br><span class="line"># Default bucket name</span><br><span class="line"># Optional, default is bucketPrefix + `default`</span><br><span class="line"># objectstorage.namespace=james</span><br><span class="line"></span><br><span class="line"># ========================================= ObjectStorage on S3 =============================================</span><br><span class="line"># Mandatory if you choose s3 storage service, S3 authentication endpoint</span><br><span class="line">#objectstorage.s3.endPoint=http://xx.xx.0.6:8000/</span><br><span class="line"></span><br><span class="line">objectstorage.s3.endPoint=https://xxx-mail.s3.amazonaws.com/mail/</span><br><span class="line"># AWS S3 å­å¨æ¡¶åç§°</span><br><span class="line">objectstorage.s3.bucketName=xxx-mail</span><br><span class="line"># Mandatory if you choose s3 storage service, S3 region</span><br><span class="line">#objectstorage.s3.region=eu-west-1</span><br><span class="line">objectstorage.s3.region=us-east-1</span><br><span class="line"></span><br><span class="line"># Mandatory if you choose aws-s3 storage service, access key id configured in S3</span><br><span class="line">objectstorage.s3.accessKeyId=xxx</span><br><span class="line"></span><br><span class="line"># Mandatory if you choose s3 storage service, secret key configured in S3</span><br><span class="line">objectstorage.s3.secretKey=xx/xxx</span><br><span class="line"></span><br><span class="line"># Optional if you choose s3 storage service: The trust store file, secret, and algorithm to use</span><br><span class="line"># when connecting to the storage service. If not specified falls back to Java defaults.</span><br><span class="line">#objectstorage.s3.truststore.path=</span><br><span class="line">#objectstorage.s3.truststore.type=JKS</span><br><span class="line">#objectstorage.s3.truststore.secret=</span><br><span class="line">#objectstorage.s3.truststore.algorithm=SunX509</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># optional: Object read in memory will be rejected if they exceed the size limit exposed here. Size, exemple `100M`.</span><br><span class="line"># Supported units: K, M, G, defaults to B if no unit is specified. If unspecified, big object won&#x27;t be prevented</span><br><span class="line"># from being loaded in memory. This settings complements protocol limits.</span><br><span class="line"># objectstorage.s3.in.read.limit=50M</span><br><span class="line"></span><br><span class="line"># ============================================ Blobs Exporting ==============================================</span><br><span class="line"># Read https://james.apache.org/server/config-blob-export.html for further details</span><br><span class="line"></span><br><span class="line"># Choosing blob exporting mechanism, allowed mechanism are: localFile, linshare</span><br><span class="line"># LinShare is a file sharing service, will be explained in the below section</span><br><span class="line"># Optional, default is localFile</span><br><span class="line">blob.export.implementation=localFile</span><br><span class="line"></span><br><span class="line"># ======================================= Local File Blobs Exporting ========================================</span><br><span class="line"># Optional, directory to store exported blob, directory path follows James file system format</span><br><span class="line"># default is file://var/blobExporting</span><br><span class="line">blob.export.localFile.directory=file://var/blobExporting</span><br><span class="line"></span><br><span class="line"># ======================================= LinShare File Blobs Exporting ========================================</span><br><span class="line"># LinShare is a sharing service where you can use james, connects to an existing LinShare server and shares files to</span><br><span class="line"># other mail addresses as long as those addresses available in LinShare. For example you can deploy James and LinShare</span><br><span class="line"># sharing the same LDAP repository</span><br><span class="line"># Mandatory if you choose LinShare, url to connect to LinShare service</span><br><span class="line"># blob.export.linshare.url=http://linshare:8080</span><br><span class="line"></span><br><span class="line"># ======================================= LinShare Configuration BasicAuthentication ===================================</span><br><span class="line"># Authentication is mandatory if you choose LinShare, TechnicalAccount is need to connect to LinShare specific service.</span><br><span class="line"># For Example: It will be formalized to &#x27;Authorization: Basic &#123;Credential of UUID/password&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># blob.export.linshare.technical.account.uuid=Technical_Account_UUID</span><br><span class="line"># blob.export.linshare.technical.account.password=password</span><br></pre></td></tr></table></figure>

<h5 id="cassandra-properties"><a href="#cassandra-properties" class="headerlink" title="cassandra.properties"></a>cassandra.properties</h5><p>这里用的是容器里的环境，先获取cassandra的ip，如果是手动安装的直接输入对应的ip和端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382/conf# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                                COMMAND                  CREATED          STATUS          PORTS                                                                                                                                                 NAMES</span><br><span class="line">13447441cafe   apache/tika                          &quot;/bin/sh -c &#x27;exec ja…&quot;   41 minutes ago   Up 41 minutes   0.0.0.0:9998-&gt;9998/tcp, :::9998-&gt;9998/tcp                                                                                                             tika</span><br><span class="line">ec1302b389dd   zenko/cloudserver:8.2.6              &quot;/usr/src/app/docker…&quot;   42 minutes ago   Up 42 minutes   8000/tcp                                                                                                                                              s3</span><br><span class="line">c25c0f731ca5   rabbitmq:3.9.18-management           &quot;docker-entrypoint.s…&quot;   43 minutes ago   Up 43 minutes   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   rabbitmq</span><br><span class="line">d4fcf76d86f9   opensearchproject/opensearch:2.1.0   &quot;./opensearch-docker…&quot;   2 hours ago      Up 2 hours      9300/tcp, 9600/tcp, 0.0.0.0:9200-&gt;9200/tcp, :::9200-&gt;9200/tcp, 9650/tcp                                                                               opensearch</span><br><span class="line">7efb7cd0942e   cassandra:3.11.10                    &quot;docker-entrypoint.s…&quot;   2 hours ago      Up 2 hours      7000-7001/tcp, 7199/tcp, 9160/tcp, 0.0.0.0:9042-&gt;9042/tcp, :::9042-&gt;9042/tcp                                                                          cassandra</span><br><span class="line">root@mail-test:/data/james/james382/conf#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382/conf# docker ps -q | xargs -n 1 docker inspect --format &#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125; &#123;&#123;.Name&#125;&#125;&#x27; | sed &#x27;s/ \// /&#x27;</span><br><span class="line">172.17.0.2 tika</span><br><span class="line">172.18.0.5 s3</span><br><span class="line">172.18.0.4 rabbitmq</span><br><span class="line">172.18.0.3 opensearch</span><br><span class="line">172.18.0.2 cassandra</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cassandra.nodes=cassandra # cassandra 的服务器地址信息，如172.19.0.2:9042</span><br><span class="line">#集群的话用逗号隔开，例如 x.x.x.6:9042,x.x.x.7:9042,x.x.x.8:9042</span><br><span class="line">#cassandra.replication.factor=1这个数字等于机器数量，假设上面的集群3台机器，这里就写3</span><br></pre></td></tr></table></figure>

<h5 id="imapserver-xml"><a href="#imapserver-xml" class="headerlink" title="imapserver.xml"></a>imapserver.xml</h5><p>主要调整SSL信息，注意会有2处配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;tls socketTLS=&quot;false&quot; startTLS=&quot;true&quot;&gt;</span><br><span class="line">            &lt;!-- To create a new keystore execute:</span><br><span class="line">              keytool -genkey -alias james -keyalg RSA -storetype PKCS12 -keystore /path/to/james/conf/keystore</span><br><span class="line">             --&gt;</span><br><span class="line">            &lt;!--&lt;keystore&gt;file://conf/keystore&lt;/keystore&gt;</span><br><span class="line">            &lt;keystoreType&gt;PKCS12&lt;/keystoreType&gt;</span><br><span class="line">            &lt;secret&gt;123456&lt;/secret&gt;</span><br><span class="line">            &lt;provider&gt;org.bouncycastle.jce.provider.BouncyCastleProvider&lt;/provider&gt;--&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- Alternatively TLS keys can be supplied via PEM files --&gt;</span><br><span class="line">             &lt;privateKey&gt;file://encrypt/privkey.pem&lt;/privateKey&gt;</span><br><span class="line">             &lt;certificates&gt;file://encrypt/fullchain.pem&lt;/certificates&gt;</span><br><span class="line">            &lt;!-- An optional secret might be specified for the private key --&gt;</span><br><span class="line">            &lt;!-- &lt;secret&gt;james72laBalle&lt;/secret&gt; --&gt;</span><br><span class="line">        &lt;/tls&gt;</span><br><span class="line">        </span><br><span class="line"> &lt;imapserver enabled=&quot;true&quot;&gt;</span><br><span class="line">        &lt;jmxName&gt;imapserver-ssl&lt;/jmxName&gt;</span><br><span class="line">        &lt;bind&gt;0.0.0.0:993&lt;/bind&gt;</span><br><span class="line">        &lt;connectionBacklog&gt;200&lt;/connectionBacklog&gt;</span><br><span class="line">        &lt;tls socketTLS=&quot;true&quot; startTLS=&quot;false&quot;&gt;</span><br><span class="line">            &lt;!-- To create a new keystore execute:</span><br><span class="line">              keytool -genkey -alias james -keyalg RSA -storetype PKCS12 -keystore /path/to/james/conf/keystore</span><br><span class="line">             --&gt;</span><br><span class="line">            &lt;!--&lt;keystore&gt;file://conf/keystore&lt;/keystore&gt;</span><br><span class="line">            &lt;keystoreType&gt;PKCS12&lt;/keystoreType&gt;</span><br><span class="line">            &lt;secret&gt;123456&lt;/secret&gt;</span><br><span class="line">            &lt;provider&gt;org.bouncycastle.jce.provider.BouncyCastleProvider&lt;/provider&gt;--&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- Alternatively TLS keys can be supplied via PEM files --&gt;</span><br><span class="line">            &lt;privateKey&gt;file://encrypt/privkey.pem&lt;/privateKey&gt;</span><br><span class="line">            &lt;certificates&gt;file://encrypt/fullchain.pem&lt;/certificates&gt;</span><br><span class="line">            &lt;!-- An optional secret might be specified for the private key --&gt;</span><br><span class="line">            &lt;!-- &lt;secret&gt;james72laBalle&lt;/secret&gt; --&gt;</span><br><span class="line">        &lt;/tls&gt;</span><br><span class="line">        &lt;connectionLimit&gt;0&lt;/connectionLimit&gt;</span><br><span class="line">        &lt;connectionLimitPerIP&gt;0&lt;/connectionLimitPerIP&gt;</span><br><span class="line">        &lt;idleTimeInterval&gt;120&lt;/idleTimeInterval&gt;</span><br><span class="line">        &lt;idleTimeIntervalUnit&gt;SECONDS&lt;/idleTimeIntervalUnit&gt;</span><br><span class="line">        &lt;enableIdle&gt;true&lt;/enableIdle&gt;</span><br><span class="line">        &lt;auth&gt;</span><br><span class="line">            &lt;plainAuthEnabled&gt;true&lt;/plainAuthEnabled&gt;</span><br><span class="line">        &lt;/auth&gt;</span><br><span class="line">    &lt;/imapserver&gt;</span><br><span class="line">&lt;/imapservers&gt;</span><br></pre></td></tr></table></figure>


<h5 id="opensearch-properties"><a href="#opensearch-properties" class="headerlink" title="opensearch.properties"></a>opensearch.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opensearch.masterHost=opensearch # opensearch的服务器连接IP和端口</span><br><span class="line">opensearch.port=9200</span><br></pre></td></tr></table></figure>

<h5 id="pop3server-xml"><a href="#pop3server-xml" class="headerlink" title="pop3server.xml"></a>pop3server.xml</h5><p>主要调整SSL信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;pop3servers&gt;</span><br><span class="line">    &lt;pop3server enabled=&quot;false&quot;&gt;</span><br><span class="line">        &lt;jmxName&gt;pop3server&lt;/jmxName&gt;</span><br><span class="line">        &lt;bind&gt;0.0.0.0:110&lt;/bind&gt;</span><br><span class="line">        &lt;connectionBacklog&gt;200&lt;/connectionBacklog&gt;</span><br><span class="line">        &lt;tls socketTLS=&quot;false&quot; startTLS=&quot;false&quot;&gt;</span><br><span class="line">            &lt;privateKey&gt;file://encrypt/privkey.pem&lt;/privateKey&gt;</span><br><span class="line">            &lt;certificates&gt;file://encrypt/fullchain.pem&lt;/certificates&gt;</span><br><span class="line">        &lt;/tls&gt;</span><br><span class="line">        &lt;connectiontimeout&gt;1200&lt;/connectiontimeout&gt;</span><br><span class="line">        &lt;connectionLimit&gt;0&lt;/connectionLimit&gt;</span><br><span class="line">        &lt;connectionLimitPerIP&gt;0&lt;/connectionLimitPerIP&gt;</span><br><span class="line">        &lt;handlerchain&gt;</span><br><span class="line">            &lt;handler class=&quot;org.apache.james.pop3server.core.CoreCmdHandlerLoader&quot;/&gt;</span><br><span class="line">        &lt;/handlerchain&gt;</span><br><span class="line">    &lt;/pop3server&gt;</span><br><span class="line">&lt;/pop3servers&gt;</span><br></pre></td></tr></table></figure>

<h5 id="rabbitmq-properties"><a href="#rabbitmq-properties" class="headerlink" title="rabbitmq.properties"></a>rabbitmq.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uri=amqp://rabbitmq:5672 # rabbitmq的服务器连接IP和端口</span><br><span class="line">management.uri=http://rabbitmq:15672 # rabbitmq的服务器连接IP和端口</span><br></pre></td></tr></table></figure>

<h5 id="smtpserver-xml"><a href="#smtpserver-xml" class="headerlink" title="smtpserver.xml"></a>smtpserver.xml</h5><p>主要调整SSL秘钥信息，注意会有3处配置，记得把mail.域名.xx解析到服务器，注意格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;connectionBacklog&gt;200&lt;/connectionBacklog&gt;</span><br><span class="line">        &lt;tls socketTLS=&quot;false&quot; startTLS=&quot;true&quot;&gt;</span><br><span class="line">            &lt;privateKey&gt;file://encrypt/privkey.pem&lt;/privateKey&gt;</span><br><span class="line">            &lt;certificates&gt;file://encrypt/fullchain.pem&lt;/certificates&gt;</span><br><span class="line">        &lt;/tls&gt;</span><br><span class="line">        &lt;helo&gt;</span><br><span class="line">            &lt;autodetect&gt;false&lt;/autodetect&gt;</span><br><span class="line">            &lt;autodetectIP&gt;false&lt;/autodetectIP&gt;</span><br><span class="line">            &lt;defaultFQDN&gt;mail.域名.xx&lt;/defaultFQDN&gt;</span><br><span class="line">        &lt;/helo&gt;</span><br><span class="line">        &lt;connectiontimeout&gt;360&lt;/connectiontimeout&gt;</span><br></pre></td></tr></table></figure>

<h5 id="tika-properties"><a href="#tika-properties" class="headerlink" title="tika.properties"></a>tika.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tika.host=tika # tika的服务器连接IP和端口</span><br></pre></td></tr></table></figure>

<h5 id="webadmin-properties"><a href="#webadmin-properties" class="headerlink" title="webadmin.properties"></a>webadmin.properties</h5><p>修改IP和端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  port=8000</span><br><span class="line">  #这里写0000就可以</span><br><span class="line">  host=0.0.0.0</span><br><span class="line">  #在文件最下面追加</span><br><span class="line">  # 启用功能模块</span><br><span class="line">mailbox.enabled=true</span><br><span class="line">message.enabled=true</span><br><span class="line"></span><br><span class="line"># 启用扩展路由（包括邮件操作 API）</span><br><span class="line">extensions.routes=org.apache.james.webadmin.routes.MailboxesRoutes,org.apache.james.webadmin.routes.MessagesRoutes</span><br></pre></td></tr></table></figure>

<h5 id="jmap-properties"><a href="#jmap-properties" class="headerlink" title="jmap.properties"></a>jmap.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># Configuration file for JMAP</span><br><span class="line"># Read https://james.apache.org/server/config-jmap.html for further details</span><br><span class="line"></span><br><span class="line">enabled=true</span><br><span class="line">jmap.port=3000</span><br><span class="line"></span><br><span class="line"># tls.keystoreURL=file://conf/keystore</span><br><span class="line"># tls.secret=123456</span><br><span class="line"></span><br><span class="line"># Alternatively TLS keys can be supplied via PEM files</span><br><span class="line">tls.privateKey=file://encrypt/privkey.pem</span><br><span class="line">tls.certificates=file://encrypt/fullchain.pem</span><br><span class="line"># An optional secret might be specified for the private key</span><br><span class="line"># tls.secret=james72laBalle</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># If you wish to use OAuth authentication, you should provide a valid JWT public key.</span><br><span class="line"># The following entry specify the link to the URL of the public key file,</span><br><span class="line"># which should be a PEM format file.</span><br><span class="line">#</span><br><span class="line"># jwt.publickeypem.url=file://conf/jwt_publickey</span><br><span class="line"></span><br><span class="line"># Should simple Email/query be resolved against a Cassandra projection, or should we resolve them against OpenSearch?</span><br><span class="line"># This enables a higher resilience, but the projection needs to be correctly populated. False by default.</span><br><span class="line"># view.email.query.enabled=true</span><br><span class="line"></span><br><span class="line"># If you want to specify authentication strategies for Jmap draft version</span><br><span class="line"># For custom Authentication Strategy not inside package &quot;org.apache.james.jmap.http&quot;, you have to specify its FQDN</span><br><span class="line"># authentication.strategy.draft=AccessTokenAuthenticationStrategy,JWTAuthenticationStrategy,QueryParameterAccessTokenAuthenticationStrategy</span><br><span class="line"></span><br><span class="line"># If you want to specify authentication strategies for Jmap rfc-8621 version</span><br><span class="line"># For custom Authentication Strategy not inside package &quot;org.apache.james.jmap.http&quot;, you have to specify its FQDN</span><br><span class="line"># authentication.strategy.rfc8621=JWTAuthenticationStrategy,BasicAuthenticationStrategy</span><br><span class="line"></span><br><span class="line"># Prevent server side request forgery by preventing calls to the private network ranges. Defaults to true, can be disabled for testing.</span><br><span class="line"># webpush.prevent.server.side.request.forgery=false</span><br></pre></td></tr></table></figure>

<h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><p>james项目根目录新建bin目录，james-server.sh文件，代码如下</p>
<p>注意：<br>1.JAMES_HOME最后面不要带斜杠<br>2.提前创建好logs文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 配置路径</span><br><span class="line">JAMES_HOME=&quot;/data/runTime/james/james382&quot;</span><br><span class="line">JAMES_CMD=&quot;java -Xms4g -Xmx8g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m \</span><br><span class="line">-XX:+UseG1GC -XX:InitiatingHeapOccupancyPercent=40 -XX:+ParallelRefProcEnabled \</span><br><span class="line">-XX:+UseStringDeduplication -Dworking.directory=. -Dlogback.configurationFile=conf/logback.xml \</span><br><span class="line">-Djdk.tls.ephemeralDHKeySize=2048 -jar james-server-distributed-app.jar&quot;</span><br><span class="line">JAMES_LOG=&quot;$JAMES_HOME/logs/james.log&quot;</span><br><span class="line">PID_FILE=&quot;$JAMES_HOME/james.pid&quot;</span><br><span class="line"></span><br><span class="line"># 检查 PID 文件是否存在且有效</span><br><span class="line">is_running() &#123;</span><br><span class="line">    if [ -f &quot;$PID_FILE&quot; ]; then</span><br><span class="line">        PID=$(cat &quot;$PID_FILE&quot;)</span><br><span class="line">        if kill -0 &quot;$PID&quot; 2&gt;/dev/null; then</span><br><span class="line">            return 0  # 服务正在运行</span><br><span class="line">        else</span><br><span class="line">            rm -f &quot;$PID_FILE&quot;  # 清理无效的 PID 文件</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    return 1  # 服务未运行</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启动服务</span><br><span class="line">start() &#123;</span><br><span class="line">    if is_running; then</span><br><span class="line">        echo &quot;James is already running with PID $(cat &quot;$PID_FILE&quot;).&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo &quot;Starting James...&quot;</span><br><span class="line">    cd &quot;$JAMES_HOME&quot; || exit 1</span><br><span class="line">    # 使用 setsid 启动服务并重定向日志</span><br><span class="line">    setsid $JAMES_CMD &gt;&gt; &quot;$JAMES_LOG&quot; 2&gt;&amp;1 &amp;</span><br><span class="line">    echo $! &gt; &quot;$PID_FILE&quot;</span><br><span class="line">    sleep 20</span><br><span class="line"></span><br><span class="line">    if is_running; then</span><br><span class="line">        echo &quot;James started successfully with PID $(cat &quot;$PID_FILE&quot;).&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;Failed to start James. Check logs for details: $JAMES_LOG&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 停止服务</span><br><span class="line">stop() &#123;</span><br><span class="line">    if ! is_running; then</span><br><span class="line">        echo &quot;James is not running.&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo &quot;Stopping James...&quot;</span><br><span class="line">    kill &quot;$(cat &quot;$PID_FILE&quot;)&quot;</span><br><span class="line">    sleep 3</span><br><span class="line"></span><br><span class="line">    if ! is_running; then</span><br><span class="line">        echo &quot;James stopped successfully.&quot;</span><br><span class="line">        rm -f &quot;$PID_FILE&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;Failed to stop James.&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 重启服务</span><br><span class="line">restart() &#123;</span><br><span class="line">    stop</span><br><span class="line">    sleep 2</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 检查服务状态</span><br><span class="line">status() &#123;</span><br><span class="line">    if is_running; then</span><br><span class="line">        echo &quot;James is running with PID $(cat &quot;$PID_FILE&quot;).&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;James is not running.&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 清理旧日志</span><br><span class="line">cleanup_logs() &#123;</span><br><span class="line">    echo &quot;Cleaning up old logs...&quot;</span><br><span class="line">    find &quot;$JAMES_HOME/logs&quot; -type f -name &quot;*.log&quot; -mtime +7 -exec rm -f &#123;&#125; \;</span><br><span class="line">    echo &quot;Log cleanup completed.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 主逻辑</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start) start ;;</span><br><span class="line">    stop) stop ;;</span><br><span class="line">    restart) restart ;;</span><br><span class="line">    status) status ;;</span><br><span class="line">    cleanup-logs) cleanup_logs ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Usage: $0 &#123;start|stop|restart|status|cleanup-logs&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h5 id="为脚本添加执行权限"><a href="#为脚本添加执行权限" class="headerlink" title="为脚本添加执行权限"></a>为脚本添加执行权限</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x bin/james-server.sh</span><br></pre></td></tr></table></figure>

<h5 id="启动James-服务"><a href="#启动James-服务" class="headerlink" title="启动James 服务"></a>启动James 服务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/james-server.sh start</span><br></pre></td></tr></table></figure>

<h5 id="或者重启James-服务"><a href="#或者重启James-服务" class="headerlink" title="或者重启James 服务"></a>或者重启James 服务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/james-server.sh restart</span><br></pre></td></tr></table></figure>

<h5 id="如果启动报错，查看一下证书"><a href="#如果启动报错，查看一下证书" class="headerlink" title="如果启动报错，查看一下证书"></a>如果启动报错，查看一下证书</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382# cd encrypt/</span><br><span class="line">root@mail-test:/data/james/james382/encrypt# ll</span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwx 2 root root 4096 Feb 11 03:15 ./</span><br><span class="line">drwxr-xr-x 7 root root 4096 Feb 11 02:46 ../</span><br><span class="line">lrwxrwxrwx 1 root root   45 Feb 11 03:15 fullchain.pem -&gt; ../../archive/kretest.com-0001/fullchain1.pem</span><br><span class="line">lrwxrwxrwx 1 root root   43 Feb 11 03:15 privkey.pem -&gt; ../../archive/kretest.com-0001/privkey1.pem</span><br><span class="line">root@mail-test:/data/james/james382/encrypt# </span><br></pre></td></tr></table></figure>

<p>可以发现encrypt文件下的证书文件有问题，并不是真的存在，而是类似于一个软连接，且连接地址并不存在，倒回查看证书生成操作</p>
<h5 id="手动启动"><a href="#手动启动" class="headerlink" title="手动启动"></a>手动启动</h5><p>根目录执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/james-server.sh start</span><br></pre></td></tr></table></figure>

<h5 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h5><p>james开机启动可能会有问题，导致服务不停重启</p>
<p>可以考虑上面的手动启动</p>
<p>检查 james 是否已设置为开机自启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl is-enabled james</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/systemd/system/james.service</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<s>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line"># 请确认系统中有该用户，或修改为合适的用户</span><br><span class="line"># Type=simple</span><br><span class="line"># User=james</span><br></pre></td></tr></table></figure>
</s>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Apache James Mail Server</span><br><span class="line">After=network.target</span><br><span class="line">Requires=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">WorkingDirectory=/data/runTime/james/james382</span><br><span class="line"></span><br><span class="line"># 使用脚本的参数启动服务</span><br><span class="line">ExecStart=/bin/bash /data/runTime/james/james382/bin/james.sh start</span><br><span class="line">ExecStop=/bin/bash /data/runTime/james/james382/bin/james.sh stop</span><br><span class="line">ExecReload=/bin/bash /data/runTime/james/james382/bin/james.sh restart</span><br><span class="line"></span><br><span class="line">PIDFile=/data/runTime/james/james382/james.pid</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">StartLimitIntervalSec=300</span><br><span class="line">StartLimitBurst=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>重载 systemd 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>开机启动并启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable james</span><br><span class="line">sudo systemctl start james</span><br></pre></td></tr></table></figure>

<p>关闭开机启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl disable james</span><br></pre></td></tr></table></figure>

<p>检查 james 是否已设置为开机自启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl is-enabled james</span><br></pre></td></tr></table></figure>

<p>检查服务状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status james</span><br></pre></td></tr></table></figure>

<p>如果启动失败，则查看日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u james.service --since &quot;2 hours ago&quot; --no-pager</span><br></pre></td></tr></table></figure>

<h5 id="配置自动续期"><a href="#配置自动续期" class="headerlink" title="配置自动续期"></a>配置自动续期</h5><p>Let’s Encrypt 证书默认有效期为 90 天，Certbot 会自动续期。为了确保 James 使用的证书始终是最新的，需要在续期后重新加载 James</p>
<h5 id="自动续期状态检测"><a href="#自动续期状态检测" class="headerlink" title="自动续期状态检测"></a>自动续期状态检测</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/# sudo certbot renew --dry-run</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Processing /etc/letsencrypt/renewal/kretest.com-0001.conf</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/renewal.py&quot;, line 65, in _reconstitute</span><br><span class="line">    renewal_candidate = storage.RenewableCert(full_path, config)</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/storage.py&quot;, line 465, in __init__</span><br><span class="line">    self._check_symlinks()</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/storage.py&quot;, line 522, in _check_symlinks</span><br><span class="line">    raise errors.CertStorageError(</span><br><span class="line">certbot.errors.CertStorageError: expected /etc/letsencrypt/live/kretest.com-0001/cert.pem to be a symlink</span><br><span class="line">Renewal configuration file /etc/letsencrypt/renewal/kretest.com-0001.conf is broken. Skipping.</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Processing /etc/letsencrypt/renewal/kretest.com-0002.conf</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Cert not due for renewal, but simulating renewal for dry run</span><br><span class="line">Plugins selected: Authenticator nginx, Installer nginx</span><br><span class="line">Renewing an existing certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">http-01 challenge for kretest.com</span><br><span class="line">http-01 challenge for www.kretest.com</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line">Dry run: skipping deploy hook command: /etc/letsencrypt/renewal-hooks/deploy/restart-james.sh</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">new certificate deployed with reload of nginx server; fullchain is</span><br><span class="line">/etc/letsencrypt/live/kretest.com-0002/fullchain.pem</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Processing /etc/letsencrypt/renewal/kretest.com.conf</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/renewal.py&quot;, line 65, in _reconstitute</span><br><span class="line">    renewal_candidate = storage.RenewableCert(full_path, config)</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/storage.py&quot;, line 465, in __init__</span><br><span class="line">    self._check_symlinks()</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/certbot/storage.py&quot;, line 522, in _check_symlinks</span><br><span class="line">    raise errors.CertStorageError(</span><br><span class="line">certbot.errors.CertStorageError: expected /etc/letsencrypt/live/kretest.com/cert.pem to be a symlink</span><br><span class="line">Renewal configuration file /etc/letsencrypt/renewal/kretest.com.conf is broken. Skipping.</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">** DRY RUN: simulating &#x27;certbot renew&#x27; close to cert expiry</span><br><span class="line">**          (The test certificates below have not been saved.)</span><br><span class="line"></span><br><span class="line">Congratulations, all renewals succeeded. The following certs have been renewed:</span><br><span class="line">  /etc/letsencrypt/live/kretest.com-0002/fullchain.pem (success)</span><br><span class="line"></span><br><span class="line">Additionally, the following renewal configurations were invalid: </span><br><span class="line">  /etc/letsencrypt/renewal/kretest.com-0001.conf (parsefail)</span><br><span class="line">  /etc/letsencrypt/renewal/kretest.com.conf (parsefail)</span><br><span class="line">** DRY RUN: simulating &#x27;certbot renew&#x27; close to cert expiry</span><br><span class="line">**          (The test certificates above have not been saved.)</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">0 renew failure(s), 2 parse failure(s)</span><br><span class="line"></span><br><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Your account credentials have been saved in your Certbot</span><br><span class="line">   configuration directory at /etc/letsencrypt. You should make a</span><br><span class="line">   secure backup of this folder now. This configuration directory will</span><br><span class="line">   also contain certificates and private keys obtained by Certbot so</span><br><span class="line">   making regular backups of this folder is ideal.</span><br><span class="line">root@mail-test:/# </span><br></pre></td></tr></table></figure>

<p>从输出日志中可以看出，Certbot 在尝试续期时遇到了两个问题：</p>
<p>/etc/letsencrypt/renewal/kretest.com-0001.conf 和 /etc/letsencrypt/renewal/kretest.com.conf 配置文件损坏：<br>错误信息表明，Certbot 期望 /etc/letsencrypt/live/kretest.com-0001/cert.pem 和 /etc/letsencrypt/live/kretest.com/cert.pem 是符号链接（symlink），但实际不是。<br>这可能是由于手动修改了证书文件或符号链接被意外删除。<br>kretest.com-0002 证书续期成功：<br>该证书的续期测试成功，说明 Certbot 的配置和运行环境没有问题</p>
<p>删除损坏的配置文件</p>
<p>如果不需要这些证书，可以直接删除损坏的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/letsencrypt/renewal/kretest.com-0001.conf</span><br><span class="line">rm /etc/letsencrypt/renewal/kretest.com.conf</span><br></pre></td></tr></table></figure>

<p>重新获取证书（如果需要）</p>
<p>如果证书已损坏且无法修复，可以删除旧证书并重新获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot delete --cert-name kretest.com-0001</span><br><span class="line">sudo certbot delete --cert-name kretest.com</span><br></pre></td></tr></table></figure>

<p>再次执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/# sudo certbot renew --dry-run</span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Processing /etc/letsencrypt/renewal/kretest.com-0002.conf</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Cert not due for renewal, but simulating renewal for dry run</span><br><span class="line">Plugins selected: Authenticator nginx, Installer nginx</span><br><span class="line">Renewing an existing certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">http-01 challenge for kretest.com</span><br><span class="line">http-01 challenge for www.kretest.com</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line">Dry run: skipping deploy hook command: /etc/letsencrypt/renewal-hooks/deploy/restart-james.sh</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">new certificate deployed with reload of nginx server; fullchain is</span><br><span class="line">/etc/letsencrypt/live/kretest.com-0002/fullchain.pem</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">** DRY RUN: simulating &#x27;certbot renew&#x27; close to cert expiry</span><br><span class="line">**          (The test certificates below have not been saved.)</span><br><span class="line"></span><br><span class="line">Congratulations, all renewals succeeded. The following certs have been renewed:</span><br><span class="line">  /etc/letsencrypt/live/kretest.com-0002/fullchain.pem (success)</span><br><span class="line">** DRY RUN: simulating &#x27;certbot renew&#x27; close to cert expiry</span><br><span class="line">**          (The test certificates above have not been saved.)</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">root@mail-test:/# </span><br></pre></td></tr></table></figure>

<h5 id="强制续期"><a href="#强制续期" class="headerlink" title="强制续期"></a>强制续期</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --force-renewal</span><br></pre></td></tr></table></figure>

<h5 id="续期钩子重启james"><a href="#续期钩子重启james" class="headerlink" title="续期钩子重启james"></a>续期钩子重启james</h5><p>自动续期后重启 James 编辑 Certbot 的续期钩子脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/letsencrypt/renewal-hooks/deploy/restart-james.sh</span><br></pre></td></tr></table></figure>

<p>如果不存在这个脚本，则新建1个，restart-james.sh完整代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 定义源和目标路径</span><br><span class="line">TARGET_DIR=&quot;/data/runTime/james/james382/encrypt/&quot;</span><br><span class="line">CERT_DIR=&quot;/etc/letsencrypt/live/mail.xx.com/&quot;</span><br><span class="line"></span><br><span class="line"># 定义文件名</span><br><span class="line">FILES=(&quot;fullchain.pem&quot; &quot;privkey.pem&quot;)</span><br><span class="line"></span><br><span class="line"># 遍历文件列表并复制</span><br><span class="line">for FILE in &quot;$&#123;FILES[@]&#125;&quot;; do</span><br><span class="line">    # 如果目标文件已存在，先删除旧文件（可选）</span><br><span class="line">    if [ -f &quot;$&#123;TARGET_DIR&#125;$&#123;FILE&#125;&quot; ]; then</span><br><span class="line">        rm -f &quot;$&#123;TARGET_DIR&#125;$&#123;FILE&#125;&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 复制新文件</span><br><span class="line">    cp -f &quot;$&#123;CERT_DIR&#125;$&#123;FILE&#125;&quot; &quot;$&#123;TARGET_DIR&#125;$&#123;FILE&#125;&quot;</span><br><span class="line"></span><br><span class="line">    # 设置文件权限</span><br><span class="line">    chmod 600 &quot;$&#123;TARGET_DIR&#125;$&#123;FILE&#125;&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 重启 James 服务</span><br><span class="line">systemctl restart james</span><br><span class="line"></span><br><span class="line">echo &quot;SSL 文件已更新并重启 James 服务&quot;</span><br></pre></td></tr></table></figure>

<h5 id="为脚本添加执行权限-1"><a href="#为脚本添加执行权限-1" class="headerlink" title="为脚本添加执行权限"></a>为脚本添加执行权限</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/letsencrypt/renewal-hooks/deploy/restart-james.sh</span><br></pre></td></tr></table></figure>

<h4 id="密钥库方式（弃用）"><a href="#密钥库方式（弃用）" class="headerlink" title="密钥库方式（弃用）"></a>密钥库方式（弃用）</h4><h5 id="生成密钥库"><a href="#生成密钥库" class="headerlink" title="生成密钥库"></a>生成密钥库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -alias james -keyalg RSA -keystore conf/keystore</span><br></pre></td></tr></table></figure>

<p>这里为了方便测试密码设置的是 q12345678</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382# keytool -genkey -alias james -keyalg RSA -keystore conf/keystore</span><br><span class="line">Enter keystore password:  </span><br><span class="line">Re-enter new password: </span><br><span class="line">What is your first and last name?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">What is the name of your organizational unit?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">What is the name of your organization?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">What is the name of your City or Locality?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">What is the name of your State or Province?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">What is the two-letter country code for this unit?</span><br><span class="line">  [Unknown]:  xen</span><br><span class="line">Is CN=xen, OU=xen, O=xen, L=xen, ST=xen, C=xen correct?</span><br><span class="line">  [no]:  yes</span><br><span class="line"></span><br><span class="line">root@mail-test:/data/james/james382#</span><br></pre></td></tr></table></figure>
<h5 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h5><p>James默认配置文件在系统文件位于 ./conf 文件夹下</p>
<h5 id="blob-properties-1"><a href="#blob-properties-1" class="headerlink" title="blob.properties"></a>blob.properties</h5><p>主要需要调整 ObjectStorage on S3 模块，将之前搭建好的 S3 服务器配置信息填上去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bjectstorage.s3.endPoint=https://xx-xx.s3.amazonaws.com/mail/ # S3 的读取器地址，换成自己的IP和端口</span><br><span class="line">objectstorage.s3.bucketName=xx-xx</span><br><span class="line">objectstorage.s3.region=us-east-1</span><br><span class="line">objectstorage.s3.accessKeyId=accessKey1 # S3 的accessKey（创建的时候有指定）</span><br><span class="line">objectstorage.s3.secretKey=secretKey1 # S3 的secretKey（创建的时候有指定）</span><br></pre></td></tr></table></figure>

<p>修改后的blob.properties文件参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># ============================================= BlobStore Implementation ==================================</span><br><span class="line"># Read https://james.apache.org/server/config-blobstore.html for further details</span><br><span class="line"></span><br><span class="line"># Choose your BlobStore implementation</span><br><span class="line"># Mandatory, allowed values are: cassandra, s3</span><br><span class="line"># *WARNING*: JAMES-3591 Cassandra is not made to store large binary content, its use will be suboptimal compared to</span><br><span class="line"># alternatives (namely S3 compatible BlobStores backed by for instance S3, MinIO or Ozone)</span><br><span class="line">implementation=s3</span><br><span class="line"></span><br><span class="line"># ========================================= Deduplication ========================================</span><br><span class="line"># If you choose to enable deduplication, the mails with the same content will be stored only once.</span><br><span class="line"># Warning: Once this feature is enabled, there is no turning back as turning it off will lead to the deletion of all</span><br><span class="line"># the mails sharing the same content once one is deleted.</span><br><span class="line"># Mandatory, Allowed values are: true, false</span><br><span class="line">deduplication.enable=false</span><br><span class="line"></span><br><span class="line"># deduplication.family needs to be incremented every time the deduplication.generation.duration is changed</span><br><span class="line"># Positive integer, defaults to 1</span><br><span class="line"># deduplication.gc.generation.family=1</span><br><span class="line"></span><br><span class="line"># Duration of generation.</span><br><span class="line"># Deduplication only takes place within a singe generation.</span><br><span class="line"># Only items two generation old can be garbage collected. (This prevent concurrent insertions issues and</span><br><span class="line"># accounts for a clock skew).</span><br><span class="line"># deduplication.family needs to be incremented everytime this parameter is changed.</span><br><span class="line"># Duration. Default unit: days. Defaults to 30 days.</span><br><span class="line"># deduplication.gc.generation.duration=30days</span><br><span class="line"></span><br><span class="line"># ========================================= Encryption ========================================</span><br><span class="line"># If you choose to enable encryption, the blob content will be encrypted before storing them in the BlobStore.</span><br><span class="line"># Warning: Once this feature is enabled, there is no turning back as turning it off will lead to all content being</span><br><span class="line"># encrypted. This comes at a performance impact but presents you from leaking data if, for instance the third party</span><br><span class="line"># offering you a S3 service is compromised.</span><br><span class="line"># Optional, Allowed values are: true, false, defaults to false</span><br><span class="line">encryption.aes.enable=false</span><br><span class="line"></span><br><span class="line"># Mandatory (if AES encryption is enabled) salt and password. Salt needs to be an hexadecimal encoded string</span><br><span class="line">#encryption.aes.password=xxx</span><br><span class="line">#encryption.aes.salt=73616c7479</span><br><span class="line"># Optional, defaults to PBKDF2WithHmacSHA512</span><br><span class="line">#encryption.aes.private.key.algorithm=PBKDF2WithHmacSHA512</span><br><span class="line"></span><br><span class="line"># ========================================= Cassandra BlobStore Cache ======================================</span><br><span class="line"># A cassandra cache can be enabled to reduce latency when reading small blobs frequently</span><br><span class="line"># A dedicated keyspace with a replication factor of one is then used</span><br><span class="line"># Cache eviction policy is TTL based</span><br><span class="line"># Only blobs below a given threshold will be stored.</span><br><span class="line"># To be noted that blobs are stored within a single Cassandra row, hence a low threshold should be used.</span><br><span class="line"></span><br><span class="line"># Enable the cache? Optional and default to false. Must be a boolean.</span><br><span class="line">cache.enable=false</span><br><span class="line"></span><br><span class="line"># Cache eviction policy is TTL based. Optional and defaults to 7 days. Must be a duration.</span><br><span class="line"># Valid units: ms, sec, min, hour, day, week, month, year</span><br><span class="line"># cache.cassandra.ttl=7days</span><br><span class="line"></span><br><span class="line"># Timeout after which this cache should be bypassed. Optional and defaults to 100ms. Can not exceed 1 hour.</span><br><span class="line"># Must be a duration Valid units: ms, sec, min, hour, day, week, month, year</span><br><span class="line"># cache.cassandra.timeout=100ms</span><br><span class="line"></span><br><span class="line"># Maximum size of stored objects expressed in bytes. Must be strictly positive. Defaults to 8192.</span><br><span class="line"># Units: bytes, Kib, MiB, GiB, TiB</span><br><span class="line"># cache.sizeThresholdInBytes=8 KiB</span><br><span class="line"></span><br><span class="line"># ============================================== ObjectStorage ============================================</span><br><span class="line"></span><br><span class="line"># ========================================= ObjectStorage Buckets ==========================================</span><br><span class="line"># bucket names prefix</span><br><span class="line"># Optional, default no prefix</span><br><span class="line"># objectstorage.bucketPrefix=prod-</span><br><span class="line"></span><br><span class="line"># Default bucket name</span><br><span class="line"># Optional, default is bucketPrefix + `default`</span><br><span class="line"># objectstorage.namespace=james</span><br><span class="line"></span><br><span class="line"># ========================================= ObjectStorage on S3 =============================================</span><br><span class="line"># Mandatory if you choose s3 storage service, S3 authentication endpoint</span><br><span class="line">#objectstorage.s3.endPoint=http://xx.xx.0.6:8000/</span><br><span class="line"></span><br><span class="line">objectstorage.s3.endPoint=https://xxx-mail.s3.amazonaws.com/mail/</span><br><span class="line"># AWS S3 å­å¨æ¡¶åç§°</span><br><span class="line">objectstorage.s3.bucketName=xxx-mail</span><br><span class="line"># Mandatory if you choose s3 storage service, S3 region</span><br><span class="line">#objectstorage.s3.region=eu-west-1</span><br><span class="line">objectstorage.s3.region=us-east-1</span><br><span class="line"></span><br><span class="line"># Mandatory if you choose aws-s3 storage service, access key id configured in S3</span><br><span class="line">objectstorage.s3.accessKeyId=xxx</span><br><span class="line"></span><br><span class="line"># Mandatory if you choose s3 storage service, secret key configured in S3</span><br><span class="line">objectstorage.s3.secretKey=xx/xxx</span><br><span class="line"></span><br><span class="line"># Optional if you choose s3 storage service: The trust store file, secret, and algorithm to use</span><br><span class="line"># when connecting to the storage service. If not specified falls back to Java defaults.</span><br><span class="line">#objectstorage.s3.truststore.path=</span><br><span class="line">#objectstorage.s3.truststore.type=JKS</span><br><span class="line">#objectstorage.s3.truststore.secret=</span><br><span class="line">#objectstorage.s3.truststore.algorithm=SunX509</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># optional: Object read in memory will be rejected if they exceed the size limit exposed here. Size, exemple `100M`.</span><br><span class="line"># Supported units: K, M, G, defaults to B if no unit is specified. If unspecified, big object won&#x27;t be prevented</span><br><span class="line"># from being loaded in memory. This settings complements protocol limits.</span><br><span class="line"># objectstorage.s3.in.read.limit=50M</span><br><span class="line"></span><br><span class="line"># ============================================ Blobs Exporting ==============================================</span><br><span class="line"># Read https://james.apache.org/server/config-blob-export.html for further details</span><br><span class="line"></span><br><span class="line"># Choosing blob exporting mechanism, allowed mechanism are: localFile, linshare</span><br><span class="line"># LinShare is a file sharing service, will be explained in the below section</span><br><span class="line"># Optional, default is localFile</span><br><span class="line">blob.export.implementation=localFile</span><br><span class="line"></span><br><span class="line"># ======================================= Local File Blobs Exporting ========================================</span><br><span class="line"># Optional, directory to store exported blob, directory path follows James file system format</span><br><span class="line"># default is file://var/blobExporting</span><br><span class="line">blob.export.localFile.directory=file://var/blobExporting</span><br><span class="line"></span><br><span class="line"># ======================================= LinShare File Blobs Exporting ========================================</span><br><span class="line"># LinShare is a sharing service where you can use james, connects to an existing LinShare server and shares files to</span><br><span class="line"># other mail addresses as long as those addresses available in LinShare. For example you can deploy James and LinShare</span><br><span class="line"># sharing the same LDAP repository</span><br><span class="line"># Mandatory if you choose LinShare, url to connect to LinShare service</span><br><span class="line"># blob.export.linshare.url=http://linshare:8080</span><br><span class="line"></span><br><span class="line"># ======================================= LinShare Configuration BasicAuthentication ===================================</span><br><span class="line"># Authentication is mandatory if you choose LinShare, TechnicalAccount is need to connect to LinShare specific service.</span><br><span class="line"># For Example: It will be formalized to &#x27;Authorization: Basic &#123;Credential of UUID/password&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># blob.export.linshare.technical.account.uuid=Technical_Account_UUID</span><br><span class="line"># blob.export.linshare.technical.account.password=password</span><br></pre></td></tr></table></figure>

<h5 id="cassandra-properties-1"><a href="#cassandra-properties-1" class="headerlink" title="cassandra.properties"></a>cassandra.properties</h5><p>如果用的是Docker容器里的环境，先获取cassandra的ip，否则直接写对应的环境ip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382/conf# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                                COMMAND                  CREATED          STATUS          PORTS                                                                                                                                                 NAMES</span><br><span class="line">13447441cafe   apache/tika                          &quot;/bin/sh -c &#x27;exec ja…&quot;   41 minutes ago   Up 41 minutes   0.0.0.0:9998-&gt;9998/tcp, :::9998-&gt;9998/tcp                                                                                                             tika</span><br><span class="line">ec1302b389dd   zenko/cloudserver:8.2.6              &quot;/usr/src/app/docker…&quot;   42 minutes ago   Up 42 minutes   8000/tcp                                                                                                                                              s3</span><br><span class="line">c25c0f731ca5   rabbitmq:3.9.18-management           &quot;docker-entrypoint.s…&quot;   43 minutes ago   Up 43 minutes   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   rabbitmq</span><br><span class="line">d4fcf76d86f9   opensearchproject/opensearch:2.1.0   &quot;./opensearch-docker…&quot;   2 hours ago      Up 2 hours      9300/tcp, 9600/tcp, 0.0.0.0:9200-&gt;9200/tcp, :::9200-&gt;9200/tcp, 9650/tcp                                                                               opensearch</span><br><span class="line">7efb7cd0942e   cassandra:3.11.10                    &quot;docker-entrypoint.s…&quot;   2 hours ago      Up 2 hours      7000-7001/tcp, 7199/tcp, 9160/tcp, 0.0.0.0:9042-&gt;9042/tcp, :::9042-&gt;9042/tcp                                                                          cassandra</span><br><span class="line">root@mail-test:/data/james/james382/conf#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james382/conf# docker ps -q | xargs -n 1 docker inspect --format &#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125; &#123;&#123;.Name&#125;&#125;&#x27; | sed &#x27;s/ \// /&#x27;</span><br><span class="line">172.17.0.2 tika</span><br><span class="line">172.18.0.5 s3</span><br><span class="line">172.18.0.4 rabbitmq</span><br><span class="line">172.18.0.3 opensearch</span><br><span class="line">172.18.0.2 cassandra</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cassandra.nodes=cassandra # cassandra 的服务器地址信息，如172.19.0.2:9042</span><br><span class="line">#集群的话用逗号隔开，例如 x.x.x.6:9042,x.x.x.7:9042,x.x.x.8:9042</span><br><span class="line">#cassandra.replication.factor=1这个数字等于机器数量，假设上面的集群3台机器，这里就写3</span><br></pre></td></tr></table></figure>

<h5 id="imapserver-xml-1"><a href="#imapserver-xml-1" class="headerlink" title="imapserver.xml"></a>imapserver.xml</h5><p>主要调整SSL秘钥信息，注意会有2处配置（秘钥信息请看步骤3）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;keystore&gt;file://conf/keystore&lt;/keystore&gt;</span><br><span class="line">&lt;keystoreType&gt;PKCS12&lt;/keystoreType&gt;</span><br><span class="line">#改这个密码</span><br><span class="line">&lt;secret&gt;james72laBalle&lt;/secret&gt;</span><br></pre></td></tr></table></figure>

<h5 id="opensearch-properties-1"><a href="#opensearch-properties-1" class="headerlink" title="opensearch.properties"></a>opensearch.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opensearch.masterHost=opensearch # opensearch的服务器连接IP和端口</span><br><span class="line">opensearch.port=9200</span><br></pre></td></tr></table></figure>

<h5 id="pop3server-xml-1"><a href="#pop3server-xml-1" class="headerlink" title="pop3server.xml"></a>pop3server.xml</h5><p>主要调整SSL秘钥信息（秘钥信息请看步骤3）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;keystore&gt;file://conf/keystore&lt;/keystore&gt;</span><br><span class="line">&lt;keystoreType&gt;PKCS12&lt;/keystoreType&gt;</span><br><span class="line">#改这个密码</span><br><span class="line">&lt;secret&gt;james72laBalle&lt;/secret&gt;</span><br></pre></td></tr></table></figure>

<h5 id="rabbitmq-properties-1"><a href="#rabbitmq-properties-1" class="headerlink" title="rabbitmq.properties"></a>rabbitmq.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uri=amqp://rabbitmq:5672 # rabbitmq的服务器连接IP和端口</span><br><span class="line">management.uri=http://rabbitmq:15672 # rabbitmq的服务器连接IP和端口</span><br></pre></td></tr></table></figure>

<h5 id="smtpserver-xml-1"><a href="#smtpserver-xml-1" class="headerlink" title="smtpserver.xml"></a>smtpserver.xml</h5><p>主要调整SSL秘钥信息，注意会有多处配置（秘钥信息请看步骤3）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;keystore&gt;file://conf/keystore&lt;/keystore&gt;</span><br><span class="line">&lt;keystoreType&gt;PKCS12&lt;/keystoreType&gt;</span><br><span class="line">&lt;secret&gt;james72laBalle&lt;/secret&gt;</span><br></pre></td></tr></table></figure>

<h5 id="tika-properties-1"><a href="#tika-properties-1" class="headerlink" title="tika.properties"></a>tika.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tika.host=tika # tika的服务器连接IP和端口</span><br></pre></td></tr></table></figure>

<h5 id="webadmin-properties-1"><a href="#webadmin-properties-1" class="headerlink" title="webadmin.properties"></a>webadmin.properties</h5><p>修改IP和端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  port=8000</span><br><span class="line">  #这里写0000就可以</span><br><span class="line">  host=0.0.0.0</span><br><span class="line">  #在文件最下面追加</span><br><span class="line">  # 启用功能模块</span><br><span class="line">mailbox.enabled=true</span><br><span class="line">message.enabled=true</span><br><span class="line"></span><br><span class="line"># 启用扩展路由（包括邮件操作 API）</span><br><span class="line">extensions.routes=org.apache.james.webadmin.routes.MailboxesRoutes,org.apache.james.webadmin.routes.MessagesRoutes</span><br></pre></td></tr></table></figure>

<h5 id="jmap-properties-1"><a href="#jmap-properties-1" class="headerlink" title="jmap.properties"></a>jmap.properties</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tls.keystoreURL=file://conf/keystore （秘钥信息请看步骤3）</span><br><span class="line">#改这个密码</span><br><span class="line">tls.secret=james72laBalle</span><br><span class="line">#加上这个</span><br><span class="line">jmap.port=3000</span><br></pre></td></tr></table></figure>

<h5 id="启动-James"><a href="#启动-James" class="headerlink" title="启动 James"></a>启动 James</h5><p>进入到 James 项目根目录执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dworking.directory=. -Dlogback.configurationFile=conf/logback.xml -Djdk.tls.ephemeralDHKeySize=2048 -jar james-server-distributed-app.jar &amp;</span><br></pre></td></tr></table></figure>

<h3 id="配置-DKIM"><a href="#配置-DKIM" class="headerlink" title="配置 DKIM"></a>配置 DKIM</h3><p>生成 DKIM 密钥对： 在 James 服务器上生成一个 DKIM 密钥对</p>
<p>在James的根目录执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out private.key 2048</span><br><span class="line">openssl rsa -in private.key -pubout -out public.key</span><br></pre></td></tr></table></figure>

<p>配置 James 使用 DKIM 签名</p>
<p>将生成的 private.key 和 public.key 移动到conf目录中</p>
<p>配置 conf/dkim.properties 没有就创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim conf/dkim.properties</span><br><span class="line">dkim.domain=域名.后缀</span><br><span class="line">dkim.selector=default</span><br><span class="line">dkim.privateKeyPath=./conf/private.key</span><br></pre></td></tr></table></figure>

<p>添加 DKIM 公钥到 DNS</p>
<p>将 public.key 的内容添加到域名的 DNS TXT 记录中。<br>TXT 记录的名称为：default._domainkey<br>TXT 记录的值：<br>v=DKIM1; k=rsa; p=<public-key-content></p>
<p>值示例:<br>v=DKIM1; k=rsa; p=公钥的内容</p>
<p>验证 DKIM 是否生效： 使用 DKIM 验证工具（如 DKIM Core）测试 DNS 配置是否正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig default._domainkey.域名.后缀 TXT</span><br></pre></td></tr></table></figure>


<p>修改/data/runTime/james/james382/conf目录下的配置文件mailetcontainer.xml</p>
<p>在配置文件中找到<processor state="transport" enableJmx="true"><br>在它下面新增这一段，私钥左对齐， d=kretest.com这里需要更改为实际域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> &lt;mailet match=&quot;All&quot; class=&quot;org.apache.james.jdkim.mailets.DKIMSign&quot;&gt;</span><br><span class="line">                &lt;signatureTemplate&gt;v=1; s=default; d=kretest.com; h=from : to : subject : date : message-id; a=rsa-sha256; bh=; b=;&lt;/signatureTemplate&gt;</span><br><span class="line">                &lt;privateKey&gt;</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpAIBAAKCAQEA04P/Qkn33jmKI19rp8cs9XLNKEUvFNl5YCJdMg1TtBFvN98q</span><br><span class="line">mWcxvkbanlxLSIrdO4hJpmMP8E171/aO/ZfWGrVExbmC/Y8fFi29kmBPvyTcgPmD</span><br><span class="line">ryAQvlC4eRldOGaUNYQmUIql/zFNzC35nESAgaTeNCP68qlHwtXj0nonmPooWZOl</span><br><span class="line">A5L+y5+dq6WNi43QXnA4DMqPQ+nMwBYpXjcgTePb10sJqtC1K6R7iEy6Prjbg9jk</span><br><span class="line">Llh/YQti81hCV5/ZTtFtqVb2AheQmHbj2hgMHc2dJIGjFfRJOvVulMI8twxpBcwf</span><br><span class="line">ZymDwC3KLfcNYP630ddH6EQvtJT29sJfpGJME05epH5Z4pIAUeBVvQ+AO7MAn7Ji</span><br><span class="line">H5fuXBsgxrZ7rFjrjNBUgCjHwoOjVk06FcRj9YAL1a78a4cR6UzuzDfhw+Of0/+a</span><br><span class="line">Di2jHoHwfOoJIasYRIgzb+J2bnnQxQxaKbFqQgMCgYEAuqn9tNcwEmCXBUEhBgnW</span><br><span class="line">+FGUnSSHlXsYhqv7kRcRTo5nGV6di6eNXKGzE85aZ/uIKCsC6WES/oRtk2nvArAr</span><br><span class="line">IfdLXrVXIf8h1R9DAfMPdu2i3ReQuDtc3QjMEgKpLIwwuq/YW1KyrZhkyQhdvBdv</span><br><span class="line">pmGdL97zIekNpvOSKIJba38CgYBTcpjDRkMN6SV8u0HKuuxoC6ZaXPFsByGopd6+</span><br><span class="line">9tidpe/j+ovYj8Pb4rKCERnq+flFwnk36U1VAY+cATKxnvX/SxE/MYR25tgfJl9L</span><br><span class="line">xs01O7hXc/tTvbTo0LqG6xs01CsWknoE/RNPWb+TKg05nKAW7eekWpCZiDFx2qKH</span><br><span class="line">93Mx7QKBgQDb6yo7Y7EqhF88ht7NSFLF0QVSaQFhzQYhShQv0soZj//2n1FIVFKn</span><br><span class="line">l1u3kAd3UUwYc93zoWKrRIAzmVrQ/QYPGo3N9mADUBLjX84eQsywVjRhvuiCNRex</span><br><span class="line">nq2fbAR8ef49TIos3PJN8EJO6Q+uCeN5sEaFC5XJqL0W1IFIts/ojQ==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">&lt;/privateKey&gt;</span><br><span class="line">&lt;/mailet&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>完整配置参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">  Licensed to the Apache Software Foundation (ASF) under one</span><br><span class="line">  or more contributor license agreements.  See the NOTICE file</span><br><span class="line">  distributed with this work for additional information</span><br><span class="line">  regarding copyright ownership.  The ASF licenses this file</span><br><span class="line">  to you under the Apache License, Version 2.0 (the</span><br><span class="line">  &quot;License&quot;); you may not use this file except in compliance</span><br><span class="line">  with the License.  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">    http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">  Unless required by applicable law or agreed to in writing,</span><br><span class="line">  software distributed under the License is distributed on an</span><br><span class="line">  &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span><br><span class="line">  KIND, either express or implied.  See the License for the</span><br><span class="line">  specific language governing permissions and limitations</span><br><span class="line">  under the License.</span><br><span class="line"> --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Read https://james.apache.org/server/config-mailetcontainer.html for further details --&gt;</span><br><span class="line"></span><br><span class="line">&lt;mailetcontainer enableJmx=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context&gt;</span><br><span class="line">        &lt;!-- When the domain part of the postmaster mailAddress is missing, the default domain is appended.</span><br><span class="line">        You can configure it to (for example) &lt;postmaster&gt;postmaster@myDomain.com&lt;/postmaster&gt; --&gt;</span><br><span class="line">        &lt;postmaster&gt;postmaster&lt;/postmaster&gt;</span><br><span class="line">    &lt;/context&gt;</span><br><span class="line"></span><br><span class="line">    &lt;spooler&gt;</span><br><span class="line">        &lt;threads&gt;20&lt;/threads&gt;</span><br><span class="line">        &lt;errorRepository&gt;cassandra://var/mail/error/&lt;/errorRepository&gt;</span><br><span class="line">    &lt;/spooler&gt;</span><br><span class="line"></span><br><span class="line">    &lt;processors&gt;</span><br><span class="line">        &lt;processor state=&quot;root&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;PostmasterAlias&quot;/&gt;</span><br><span class="line">            &lt;mailet match=&quot;RelayLimit=30&quot; class=&quot;Null&quot;/&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToProcessor&quot;&gt;</span><br><span class="line">                &lt;processor&gt;transport&lt;/processor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;error&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;MetricsMailet&quot;&gt;</span><br><span class="line">                &lt;metricName&gt;mailetContainerErrors&lt;/metricName&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;Bounce&quot;&gt;</span><br><span class="line">                &lt;onMailetException&gt;ignore&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToRepository&quot;&gt;</span><br><span class="line">                &lt;repositoryPath&gt;cassandra://var/mail/error/&lt;/repositoryPath&gt;</span><br><span class="line">                &lt;onMailetException&gt;propagate&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;transport&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!--</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;org.apache.james.jdkim.mailets.DKIMSign&quot;&gt;</span><br><span class="line">                &lt;signatureTemplate&gt;v=1; s=default; d=touchsmail.com; h=from:to:received:received; a=rsa-sha256; bh=; b=;&lt;/signatureTemplate&gt;</span><br><span class="line">                &lt;privateKeyFilepath&gt;file://dkim/dkim_private.key&lt;/privateKeyFilepath&gt;</span><br><span class="line">                &lt;forceCRLF&gt;false&lt;/forceCRLF&gt;</span><br><span class="line">                &lt;debug&gt;true&lt;/debug&gt;</span><br><span class="line">                &lt;/mailet&gt;--&gt;</span><br><span class="line"></span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;org.apache.james.jdkim.mailets.DKIMSign&quot;&gt;</span><br><span class="line">                &lt;signatureTemplate&gt;v=1; s=default; d=xxx.com; h=from : to : subject : date : message-id; a=rsa-sha256; bh=; b=;&lt;/signatureTemplate&gt;</span><br><span class="line">                &lt;privateKey&gt;</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpAIBAAKCAQEA5C+HETgshKcHrSuuodJYph+3j4eHkrcvALTKsnGqDPrR4V0C</span><br><span class="line">RsofqHlgO4JyDuZLKcwVj6J7R34b0L2se8+CIkakpllFXkZ7FfAw/71yCzJJ5KhL</span><br><span class="line">EoZIwE5G+ay8R3On7TDjIDeMRKTtxkYEa/2MlOyG5T4x6cW82mT1oYWz7WMBOOeT</span><br><span class="line">TRTa/e0KNkvLzuGpLSETyOn0qKXmVe0JyTtCqQx9fgToIIUbCNXCTmei3U3eEajj</span><br><span class="line">Xa1KhmyeKSL+L0M6Gdj5B267NGTXVQlLTBwOLFduGpkNJIKeQk7EOo7FvKYVFct/</span><br><span class="line">UZd90ygTSTQ0GR4QUP1Wup2ESXSvYBie0idkJGiLrtEWpWsFbiyH+CbajMypaGSq</span><br><span class="line">5U0OmtFbbDZ++8T724/mvDThTwbhVIaw+d9NZr60Yg6B91rPaUoCpxAsXK8WkrZo</span><br><span class="line">UEmL/mS6M2jrLOX7tiYJdwKBgQCvhnSJNWngeg9VjIRWEc80kiNsbqOnHpbePgvj</span><br><span class="line">Qw1h0LkCAffQ9uq2U13IUMZYOdpgvgykLVeCAzrQAzjvS/GyuurFXRZ2EhXphVvk</span><br><span class="line">j/q4/y0ZkNO3veYB+lICwJtXfwlqzKgIcKX2j7c7RcEUxFoKInR9A+YsLX8DDEel</span><br><span class="line">KHKmGQKBgQCD+7xpDVpR6N082QPl7A4IEh2S9bRz1b135ipbi4Oks8Xgu+JxWMq0</span><br><span class="line">J7uAAA258xD2T5REfW4fKuIXzSNBo2ovEHcpqSt6jGvc5rCBYPV6Q3CDmRMu8pSV</span><br><span class="line">agtW9gaNnxJUo3BYc55L+sPNjDZsmZSe+TekJZ9tCgGBcosZM+PMwQ==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">&lt;/privateKey&gt;</span><br><span class="line">&lt;/mailet&gt;</span><br><span class="line"></span><br><span class="line">            &lt;matcher name=&quot;relay-allowed&quot; match=&quot;org.apache.james.mailetcontainer.impl.matchers.Or&quot;&gt;</span><br><span class="line">                &lt;matcher match=&quot;SMTPAuthSuccessful&quot;/&gt;</span><br><span class="line">                &lt;matcher match=&quot;SMTPIsAuthNetwork&quot;/&gt;</span><br><span class="line">                &lt;matcher match=&quot;SentByMailet&quot;/&gt;</span><br><span class="line">                &lt;matcher match=&quot;org.apache.james.jmap.mailet.SentByJmap&quot;/&gt;</span><br><span class="line">            &lt;/matcher&gt;</span><br><span class="line"></span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;RemoveMimeHeader&quot;&gt;</span><br><span class="line">                &lt;name&gt;bcc&lt;/name&gt;</span><br><span class="line">                &lt;onMailetException&gt;ignore&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;RecipientRewriteTable&quot;&gt;</span><br><span class="line">                &lt;errorProcessor&gt;rrt-error&lt;/errorProcessor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;RecipientIsLocal&quot; class=&quot;ToProcessor&quot;&gt;</span><br><span class="line">                &lt;processor&gt;local-delivery&lt;/processor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;HostIsLocal&quot; class=&quot;ToProcessor&quot;&gt;</span><br><span class="line">                &lt;processor&gt;local-address-error&lt;/processor&gt;</span><br><span class="line">                &lt;notice&gt;550 - Requested action not taken: no such user here&lt;/notice&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;relay-allowed&quot; class=&quot;ToProcessor&quot;&gt;</span><br><span class="line">                &lt;processor&gt;relay&lt;/processor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToProcessor&quot;&gt;</span><br><span class="line">                &lt;processor&gt;relay-denied&lt;/processor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;local-delivery&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;VacationMailet&quot;&gt;</span><br><span class="line">                &lt;onMailetException&gt;ignore&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;Sieve&quot;&gt;</span><br><span class="line">                &lt;onMailetException&gt;ignore&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;AddDeliveredToHeader&quot;/&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;org.apache.james.jmap.mailet.filter.JMAPFiltering&quot;&gt;</span><br><span class="line">                &lt;onMailetException&gt;ignore&lt;/onMailetException&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;LocalDelivery&quot;/&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;relay&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;RemoteDelivery&quot;&gt;</span><br><span class="line">                &lt;outgoingQueue&gt;outgoing&lt;/outgoingQueue&gt;</span><br><span class="line">                &lt;delayTime&gt;5000, 100000, 500000&lt;/delayTime&gt;</span><br><span class="line">                &lt;maxRetries&gt;3&lt;/maxRetries&gt;</span><br><span class="line">                &lt;maxDnsProblemRetries&gt;0&lt;/maxDnsProblemRetries&gt;</span><br><span class="line">                &lt;deliveryThreads&gt;10&lt;/deliveryThreads&gt;</span><br><span class="line">                &lt;sendpartial&gt;true&lt;/sendpartial&gt;</span><br><span class="line">                &lt;bounceProcessor&gt;bounces&lt;/bounceProcessor&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;local-address-error&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;MetricsMailet&quot;&gt;</span><br><span class="line">                &lt;metricName&gt;mailetContainerLocalAddressError&lt;/metricName&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;Bounce&quot;&gt;</span><br><span class="line">                &lt;attachment&gt;none&lt;/attachment&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToRepository&quot;&gt;</span><br><span class="line">                &lt;repositoryPath&gt;cassandra://var/mail/address-error/&lt;/repositoryPath&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;relay-denied&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;MetricsMailet&quot;&gt;</span><br><span class="line">                &lt;metricName&gt;mailetContainerRelayDenied&lt;/metricName&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;Bounce&quot;&gt;</span><br><span class="line">                &lt;attachment&gt;none&lt;/attachment&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToRepository&quot;&gt;</span><br><span class="line">                &lt;repositoryPath&gt;cassandra://var/mail/relay-denied/&lt;/repositoryPath&gt;</span><br><span class="line">                &lt;notice&gt;Warning: You are sending an e-mail to a remote server. You must be authenticated to perform such an operation&lt;/notice&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;bounces&quot; enableJmx=&quot;true&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;MetricsMailet&quot;&gt;</span><br><span class="line">                &lt;metricName&gt;bounces&lt;/metricName&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;DSNBounce&quot;&gt;</span><br><span class="line">                &lt;passThrough&gt;false&lt;/passThrough&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">        &lt;processor state=&quot;rrt-error&quot; enableJmx=&quot;false&quot;&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;ToRepository&quot;&gt;</span><br><span class="line">                &lt;repositoryPath&gt;cassandra://var/mail/rrt-error/&lt;/repositoryPath&gt;</span><br><span class="line">                &lt;passThrough&gt;true&lt;/passThrough&gt;</span><br><span class="line">            &lt;/mailet&gt;</span><br><span class="line">            &lt;mailet match=&quot;IsSenderInRRTLoop&quot; class=&quot;Null&quot;/&gt;</span><br><span class="line">            &lt;mailet match=&quot;All&quot; class=&quot;Bounce&quot;/&gt;</span><br><span class="line">        &lt;/processor&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/processors&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mailetcontainer&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改后重启james</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/james-server.sh stop</span><br><span class="line">./bin/james-server.sh start</span><br></pre></td></tr></table></figure>



<h2 id="安装-James-客户端"><a href="#安装-James-客户端" class="headerlink" title="安装 James 客户端"></a>安装 James 客户端</h2><p>James 客户端需要 James 源代码中自己编译打包后运行，步骤如下</p>
<p><a target="_blank" rel="noopener" href="https://dlcdn.apache.org/james/server/3.8.2/james-project-3.8.2-source-release.zip">源码包</a></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dlcdn.apache.org/james/server/3.8.2/james-project-3.8.2-source-release.zip</span><br></pre></td></tr></table></figure>

<h3 id="解压并进入目录"><a href="#解压并进入目录" class="headerlink" title="解压并进入目录"></a>解压并进入目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james# unzip james-project-3.8.2-source-release.zip</span><br><span class="line">root@mail-test:/data/james# mv james-project-3.8.2 james-project</span><br><span class="line">root@mail-test:/data/james# ls</span><br><span class="line">james-project  james-project-3.8.2-source-release.zip  james382</span><br><span class="line">root@mail-test:/data/james# cd james-project/server/apps/webadmin-cli</span><br><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli#</span><br></pre></td></tr></table></figure>

<h3 id="打包编译"><a href="#打包编译" class="headerlink" title="打包编译"></a>打包编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>

<h3 id="进入客户端目录"><a href="#进入客户端目录" class="headerlink" title="进入客户端目录"></a>进入客户端目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james-project# cd server/apps/webadmin-cli/</span><br><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# ls</span><br><span class="line">README.md  james-cli  pom.xml  src  target</span><br><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli#</span><br></pre></td></tr></table></figure>


<h3 id="添加域"><a href="#添加域" class="headerlink" title="添加域"></a>添加域</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./james-cli --url http://127.0.0.1:9999 domain create &lt;domainToBeCreated&gt;</span><br></pre></td></tr></table></figure>

<p>执行之前先确认james服务正在运行，我执行报错了，且确认james服务正在运行中，报错信息如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# ./james-cli --url http://127.0.0.1:9999 domain create kretest.com</span><br><span class="line">SLF4J: No SLF4J providers were found.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.</span><br><span class="line">feign.RetryableException: Unexpected end of file from server executing PUT http://127.0.0.1:9999/domains/kretest.com</span><br><span class="line">        at feign.FeignException.errorExecuting(FeignException.java:268)</span><br><span class="line">        at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:131)</span><br><span class="line">        at feign.SynchronousMethodHandler.invoke(SynchronousMethodHandler.java:91)</span><br><span class="line">        at feign.ReflectiveFeign$FeignInvocationHandler.invoke(ReflectiveFeign.java:100)</span><br><span class="line">        at com.sun.proxy.$Proxy9.createADomain(Unknown Source)</span><br><span class="line">        at org.apache.james.webadmin.httpclient.DomainClient.createADomain(DomainClient.java:43)</span><br><span class="line">        at org.apache.james.cli.domain.DomainCreateCommand.call(DomainCreateCommand.java:41)</span><br><span class="line">        at org.apache.james.cli.domain.DomainCreateCommand.call(DomainCreateCommand.java:28)</span><br><span class="line">        at picocli.CommandLine.executeUserObject(CommandLine.java:1953)</span><br><span class="line">        at picocli.CommandLine.access$1300(CommandLine.java:145)</span><br><span class="line">        at picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2358)</span><br><span class="line">        at picocli.CommandLine$RunLast.handle(CommandLine.java:2352)</span><br><span class="line">        at picocli.CommandLine$RunLast.handle(CommandLine.java:2314)</span><br><span class="line">        at picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2179)</span><br><span class="line">        at picocli.CommandLine$RunLast.execute(CommandLine.java:2316)</span><br><span class="line">        at picocli.CommandLine.execute(CommandLine.java:2078)</span><br><span class="line">        at org.apache.james.cli.WebAdminCli.execute(WebAdminCli.java:79)</span><br><span class="line">        at org.apache.james.cli.WebAdminCli.main(WebAdminCli.java:67)</span><br><span class="line">Caused by: java.net.SocketException: Unexpected end of file from server</span><br><span class="line">        at java.base/sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:917)</span><br><span class="line">        at java.base/sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:724)</span><br><span class="line">        at java.base/sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:914)</span><br><span class="line">        at java.base/sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:724)</span><br><span class="line">        at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1652)</span><br><span class="line">        at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1557)</span><br><span class="line">        at java.base/java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:527)</span><br><span class="line">        at feign.Client$Default.convertResponse(Client.java:110)</span><br><span class="line">        at feign.Client$Default.execute(Client.java:106)</span><br><span class="line">        at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:121)</span><br><span class="line">        ... 16 more</span><br></pre></td></tr></table></figure>

<p>查看之前配置的webadmin.properties文件，发现我配置的端口是8000，修改后执行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# ./james-cli --url http://127.0.0.1:8000 domain create kretest.com</span><br><span class="line">SLF4J: No SLF4J providers were found.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.</span><br><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# </span><br></pre></td></tr></table></figure>

<h3 id="查看域列表"><a href="#查看域列表" class="headerlink" title="查看域列表"></a>查看域列表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./james-cli --url http://127.0.0.1:8000 domain list</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# ./james-cli --url http://127.0.0.1:8000 domain list</span><br><span class="line">SLF4J: No SLF4J providers were found.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.</span><br><span class="line">kretest.com</span><br><span class="line">localhost</span><br><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli#</span><br></pre></td></tr></table></figure>

<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./james-cli --url http://127.0.0.1:9999 user create &lt;username&gt; --password</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@mail-test:/data/james/james-project/server/apps/webadmin-cli# ./james-cli --url http://127.0.0.1:8000 user create x@xx.com --password</span><br><span class="line">Enter value for --password (Password): </span><br><span class="line">SLF4J: No SLF4J providers were found.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.</span><br><span class="line">The user was created successfully</span><br></pre></td></tr></table></figure>

<h3 id="查看用户列表"><a href="#查看用户列表" class="headerlink" title="查看用户列表"></a>查看用户列表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./james-cli --url http://127.0.0.1:8000 user list</span><br></pre></td></tr></table></figure>

<h3 id="更多指令"><a href="#更多指令" class="headerlink" title="更多指令"></a>更多指令</h3><p><a target="_blank" rel="noopener" href="https://github.com/apache/james-project/tree/master/server/apps/webadmin-cli#get-the-list-of-domains">更多指令</a></p>
<h2 id="测试James"><a href="#测试James" class="headerlink" title="测试James"></a>测试James</h2><p>这里用的thunderbird客户端</p>
<p><a target="_blank" rel="noopener" href="https://www.thunderbird.net/">thunderbird</a></p>
<p>打开客户端输入昵称</p>
<p>输入上面创建的邮箱账号</p>
<p>输入邮箱密码</p>
<p>登陆测试</p>
<p>第一次发送邮件测试报错，报错信息为证书不匹配之类的错误，后面又发送了几次，除开第一次，其他的都成功了</p>
<p>如果收件箱没看到邮箱，可以看一下垃圾箱</p>
<p>测试完发件功能，测试收件，发现收不到邮件</p>
<p>防火墙需要打开以下端口</p>
<p>25,110,143,465,587,993,995</p>
<h2 id="opensearch查看邮件"><a href="#opensearch查看邮件" class="headerlink" title="opensearch查看邮件"></a>opensearch查看邮件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;http://mail.xx.ai:9200/mailbox_v1/_search&quot; -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;aggregations&quot;:&#123;&quot;unique_message_count&quot;:&#123;&quot;cardinality&quot;:&#123;&quot;field&quot;:&quot;mimeMessageID&quot;&#125;&#125;&#125;,&quot;collapse&quot;:&#123;&quot;field&quot;:&quot;mimeMessageID&quot;&#125;,&quot;from&quot;:0,&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;should&quot;:[&#123;&quot;term&quot;:&#123;&quot;from.address.raw&quot;:&#123;&quot;value&quot;:&quot;test007@xx.ai&quot;&#125;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;to.address.raw&quot;:&#123;&quot;value&quot;:&quot;test007@xx.ai&quot;&#125;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;cc.address.raw&quot;:&#123;&quot;value&quot;:&quot;test007@xx.ai&quot;&#125;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;bcc.address.raw&quot;:&#123;&quot;value&quot;:&quot;test007@xx.ai&quot;&#125;&#125;&#125;,&#123;&quot;nested&quot;:&#123;&quot;path&quot;:&quot;headers&quot;,&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;term&quot;:&#123;&quot;headers.name&quot;:&#123;&quot;value&quot;:&quot;delivered-to&quot;&#125;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;headers.value&quot;:&#123;&quot;value&quot;:&quot;test007@xx.ai&quot;&#125;&#125;&#125;]&#125;&#125;&#125;&#125;]&#125;&#125;,&quot;size&quot;:5,&quot;sort&quot;:[&#123;&quot;date&quot;:&#123;&quot;order&quot;:&quot;desc&quot;&#125;&#125;]&#125;&#x27;</span><br></pre></td></tr></table></figure>



<div class="article-footer reveal fs14"><section id="share"><div class="header"><span>分享文章</span></div><div class="body"><div class="link"><input class="copy-area" readonly="true" id="copy-link" value="https://su3.cn/2025/02/10/2025james02/" /></div><div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot)"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/social/b32ef3da1162a.svg"/></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=https://su3.cn/2025/02/10/2025james02/&title=james分布式版本部署二 - 苏三博客&summary=james分布式版本部署"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/social/80c07e4dbb303.svg"/></a><a class="social share-item email" href="mailto:?subject=james分布式版本部署二 - 苏三博客&amp;body=https://su3.cn/2025/02/10/2025james02/"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/social/a1b00e20f425d.svg"/></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;复制成功&quot;)"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/social/8411ed322ced6.svg"/></a></div><div class="qrcode" id="qrcode-wechat" style="visibility:hidden;height:0"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=https://su3.cn/2025/02/10/2025james02/"/></div></div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2025/02/10/2025james01/">james分布式版本部署一</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2025/02/06/2025020605/">jpom构建前端vue后自动部署，消息推送</a></div></section></div>






  <div class='related-wrap md-text reveal' id="comments">
    <section class='header cmt-title cap theme'>
      快来参与讨论吧
    </section>
    <section class='body cmt-body giscus'>
      

<svg class="loading" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="giscus" data-repo="zhhltc/blogcomments" data-repo-id="R_kgDOI35Puw" data-category="Announcements" data-category-id="DIC_kwDOI35Pu84CT54y" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous"></div>

    </section>
  </div>



      
<footer class="page-footer reveal fs12"><hr><div class="text"><div class="BeiAn-info" style="display: flex;text-align: center;margin:10px;justify-content: center; align-items: center;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/p/imgs/beian.png" title="备案管理系统" style="width:15px;height:15px;"> <a href="http://beian.miit.gov.cn/" style="text-decoration:none;" target=_blank title=备案号>赣ICP备17016237号-1</a></div><div  style="display: flex;text-align: center;justify-content: center; align-items: center;"><span id="timeDate">载入天数...</span>|<span id="times">载入时分秒...</span><span class="post-meta-divider">|</span><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span class="post-meta-divider">|</span><span id="busuanzi_container_site_uv" style="display:none">本站访客数<span id="busuanzi_value_site_uv"></span>人</span></div><script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script><script type="text/javascript" src="/js/dist/zoomify.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></footer>

<!--添加网站运行时间 -->
<!--<br/>-->

<script>
    var now = new Date();

    function createtime() {
        var grt = new Date("11/01/2021 12:00:00");
        now.setTime(now.getTime() + 250);
        days = (now - grt) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if (String(hnum).length == 1) {
            hnum = "0" + hnum;
        }
        minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if (String(mnum).length == 1) {
            mnum = "0" + mnum;
        }
        seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if (String(snum).length == 1) {
            snum = "0" + snum;
        }
        document.getElementById("timeDate").innerHTML = "本站已安全运行 " + dnum + " 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval("createtime()", 250);
</script>
<!-- 添加网站运行时间》 -->

<style>
  /*返回顶部的css*/
.All_url_totop{
position:fixed;right:10px;width: 35px;height: 35px; border-radius: 5px; position: fixed;right: 10px; cursor: pointer;background-repeat: no-repeat; background-position: 50% 50%; background-color: #000; opacity: .1; transition: opacity .2s ease-in-out;z-index: 99999;
}
#All_url_totop{
background-image:url(data:img/png;base64,R0lGODlhEgAUAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAASABQAAAImjI+py+IPo4xmWmRpyq5dFkzgoY3VY5KS9ykcKy6vnMEr3W417hQAOw==);
top:384px;
}
#All_url_totop2{
background-image:url(data:img/png;base64,R0lGODlhEgAUAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAASABQAAAIqlB2peX27nINKNsoswnrTLmABKJKcJH5PGl3siKZdabZgWN2rzuPv/yoAADs=);
top:429px;
}
#All_url_totop:hover,
#All_url_totop2:hover{
opacity: .5;
}
</style>

<script>
 if (!window.location.href.includes("music")) {
        window.onload = function () {
          /*添加返回顶部按钮*/
          var a = document.createElement("a");
          a.setAttribute("href", "JavaScript:window.scrollTo(0,0);");
          a.setAttribute("id", "All_url_totop")
          a.setAttribute("class", "All_url_totop");
          document.body.appendChild(a);
          /*添加返回底部的按钮*/
          var a = document.createElement("a");
          a.setAttribute("href", "JavaScript:window.scrollTo(0,document.body.scrollHeight);");
          a.setAttribute("id", "All_url_totop2")
          a.setAttribute("class", "All_url_totop");
          document.body.appendChild(a);
        }
      }
</script>

        
        <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

      
    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.19.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->

  <script>
  function loadJS() {
    const els = document.querySelectorAll("#comments #giscus");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.log(error);
      }
      var script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
    loadJS();
  });
</script>




<!-- inject -->


  </div>
</body>
</html>
