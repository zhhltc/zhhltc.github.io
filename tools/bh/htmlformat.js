function style_html(a,b,c){function e(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(a,b){for(var c=0;c<b.length;c++)if(a===b[c])return!0;return!1}},this.get_content=function(){for(var d,a="",b=[],c=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];if(a=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(a,this.Utils.whitespace))b.length&&(c=!0),this.line_char_count--;else{if(c){if(this.line_char_count>=this.max_char){for(b.push("\n"),d=0;d<this.indent_level;d++)b.push(this.indent_string);this.line_char_count=0}else b.push(" "),this.line_char_count++;c=!1}b.push(a)}}return b.length?b.join(""):""},this.get_script=function(){var d,e,a="",b=[],c=new RegExp("</script>","igm");for(c.lastIndex=this.pos,d=c.exec(this.input),e=d?d.index:this.input.length;this.pos<e;){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];a=this.input.charAt(this.pos),this.pos++,b.push(a)}return b.length?b.join(""):""},this.record_tag=function(a){this.tags[a+"count"]?(this.tags[a+"count"]++,this.tags[a+this.tags[a+"count"]]=this.indent_level):(this.tags[a+"count"]=1,this.tags[a+this.tags[a+"count"]]=this.indent_level),this.tags[a+this.tags[a+"count"]+"parent"]=this.tags.parent,this.tags.parent=a+this.tags[a+"count"]},this.retrieve_tag=function(a){if(this.tags[a+"count"]){for(var b=this.tags.parent;b&&a+this.tags[a+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[a+this.tags[a+"count"]],this.tags.parent=this.tags[b+"parent"]),delete this.tags[a+this.tags[a+"count"]+"parent"],delete this.tags[a+this.tags[a+"count"]],1==this.tags[a+"count"]?delete this.tags[a+"count"]:this.tags[a+"count"]--}},this.get_tag=function(){var d,e,f,g,a="",b=[],c=!1;do{if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];a=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(a,this.Utils.whitespace)?(c=!0,this.line_char_count--):(("'"===a||'"'===a)&&(b[1]&&"!"===b[1]||(a+=this.get_unformatted(a),c=!0)),"="===a&&(c=!1),b.length&&"="!==b[b.length-1]&&">"!==a&&c&&(this.line_char_count>=this.max_char?(this.print_newline(!1,b),this.line_char_count=0):(b.push(" "),this.line_char_count++),c=!1),b.push(a))}while(">"!==a);return d=b.join(""),e=-1!=d.indexOf(" ")?d.indexOf(" "):d.indexOf(">"),f=d.substring(1,e).toLowerCase(),"/"===d.charAt(d.length-2)||this.Utils.in_array(f,this.Utils.single_token)?this.tag_type="SINGLE":"script"===f?(this.record_tag(f),this.tag_type="SCRIPT"):"style"===f?(this.record_tag(f),this.tag_type="STYLE"):"!"===f.charAt(0)?-1!=f.indexOf("[if")?(-1!=d.indexOf("!IE")&&(g=this.get_unformatted("-->",d),b.push(g)),this.tag_type="START"):-1!=f.indexOf("[endif")?(this.tag_type="END",this.unindent()):-1!=f.indexOf("[cdata[")?(g=this.get_unformatted("]]>",d),b.push(g),this.tag_type="SINGLE"):(g=this.get_unformatted("-->",d),b.push(g),this.tag_type="SINGLE"):("/"===f.charAt(0)?(this.retrieve_tag(f.substring(1)),this.tag_type="END"):(this.record_tag(f),this.tag_type="START"),this.Utils.in_array(f,this.Utils.extra_liners)&&this.print_newline(!0,this.output)),b.join("")},this.get_unformatted=function(a,b){var c,d,e,f;if(b&&-1!=b.indexOf(a))return"";c="",d="",e=!0;do{if(c=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(c,this.Utils.whitespace)){if(!e){this.line_char_count--;continue}if("\n"===c||"\r"===c){for(d+="\n",f=0;f<this.indent_level;f++)d+=this.indent_string;e=!1,this.line_char_count=0;continue}}d+=c,this.line_char_count++,e=!0}while(-1==d.indexOf(a));return d},this.get_token=function(){var a,b,c;return"TK_TAG_SCRIPT"===this.last_token?(b=this.get_script(),"string"!=typeof b?b:(a=js_beautify(b,this.indent_size,this.indent_character,this.indent_level),[a,"TK_CONTENT"])):"CONTENT"===this.current_mode?(a=this.get_content(),"string"!=typeof a?a:[a,"TK_CONTENT"]):"TAG"===this.current_mode?(a=this.get_tag(),"string"!=typeof a?a:(c="TK_TAG_"+this.tag_type,[a,c])):void 0},this.printer=function(a,b,c,d){this.input=a||"",this.output=[],this.indent_character=b||" ",this.indent_string="",this.indent_size=c||2,this.indent_level=0,this.max_char=d||70,this.line_char_count=0;for(var e=0;e<this.indent_size;e++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){if(this.line_char_count=0,b&&b.length){if(!a)for(;this.Utils.in_array(b[b.length-1],this.Utils.whitespace);)b.pop();b.push("\n");for(var c=0;c<this.indent_level;c++)b.push(this.indent_string)}},this.print_token=function(a){this.output.push(a)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var e,g,f=new e;for(f.printer(a,c,b);;){if(g=f.get_token(),f.token_text=g[0],f.token_type=g[1],"TK_EOF"===f.token_type)break;switch(f.token_type){case"TK_TAG_START":case"TK_TAG_SCRIPT":case"TK_TAG_STYLE":f.print_newline(!1,f.output),f.print_token(f.token_text),f.indent(),f.current_mode="CONTENT";break;case"TK_TAG_END":f.print_newline(!0,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_TAG_SINGLE":f.print_newline(!1,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_CONTENT":""!==f.token_text&&(f.print_newline(!1,f.output),f.print_token(f.token_text)),f.current_mode="TAG"}f.last_token=f.token_type,f.last_text=f.token_text}return f.output.join("")}